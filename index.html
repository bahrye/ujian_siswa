<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>CBT SYSTEM PRO</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>
    
    <?!= include('Stylesheet'); ?>
  </head>
  <body>

    <div id="login-container" class="min-h-screen flex items-center justify-center bg-slate-900 p-4">
      <div class="glass-panel w-full max-w-sm p-8 rounded-xl shadow-2xl">
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-indigo-600 rounded-lg mx-auto flex items-center justify-center mb-3">
            <i class="fas fa-laptop-code text-white text-3xl"></i>
          </div>
          <h1 class="text-2xl font-bold text-slate-800">CBT LOGIN</h1>
          <p class="text-gray-500 text-xs">Admin • Guru • Pengawas • Siswa</p>
        </div>
        <form onsubmit="App.Auth.login(event)" class="space-y-4">
          <input type="text" id="user" class="input-std" placeholder="Username" required>
          <input type="password" id="pass" class="input-std" placeholder="Password" required>
          <button type="submit" id="btnLogin" class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded transition">
            MASUK
          </button>
        </form>
      </div>
    </div>

    <div id="dashboard-container" class="hidden flex h-screen overflow-hidden bg-gray-100 relative">
      
      <div id="sidebar-backdrop" onclick="App.UI.toggleSidebar()" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden glass-panel"></div>

      <aside id="sidebar-panel" class="absolute md:static inset-y-0 left-0 w-64 bg-slate-900 text-white flex flex-col shadow-xl z-30 transform -translate-x-full md:translate-x-0 sidebar-transition">
        <div class="h-16 flex items-center justify-between px-6 border-b border-slate-700 font-bold text-lg tracking-wider">
          <span><i class="fas fa-graduation-cap text-indigo-400"></i> CBT ADMIN</span>
          <button onclick="App.UI.toggleSidebar()" class="md:hidden text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>

        <div class="p-4 border-b border-slate-800">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-lg">
              <span id="dash-initial">A</span>
            </div>
            <div class="overflow-hidden">
              <p class="text-sm font-semibold truncate" id="dash-nama">User</p>
              <p class="text-xs text-indigo-300 uppercase" id="dash-role">Role</p>
            </div>
          </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1" id="sidebar-menu"></nav>

        <div class="p-4 border-t border-slate-800">
          <button onclick="App.Auth.logout()" class="flex items-center gap-3 w-full px-4 py-2 text-red-400 hover:bg-slate-800 rounded transition">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </aside>

      <main class="flex-1 flex flex-col overflow-hidden relative w-full">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-4 md:px-6 z-10 shrink-0">
          <div class="flex items-center gap-3">
             <button onclick="App.UI.toggleSidebar()" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded">
               <i class="fas fa-bars text-xl"></i>
             </button>
             <h2 class="text-lg md:text-xl font-bold text-gray-700 truncate" id="page-title">Dashboard</h2>
          </div>
          <div class="text-xs md:text-sm text-gray-500 text-right" id="current-date"></div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-6 scroll-smooth" id="main-view-area">
          
          <div id="view-dashboard" class="space-y-6 animate__animated animate__fadeIn">
             <div class="flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-700">Statistik Sistem</h3>
                <button onclick="App.Dashboard.loadStats(true)" class="text-gray-500 hover:text-indigo-600 transition" title="Refresh Data">
                    <i id="btn-refresh-dash" class="fas fa-sync-alt"></i>
                </button>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Total Pengguna</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-user">-</h3></div>
                   <div class="p-3 bg-blue-50 text-blue-600 rounded-lg"><i class="fas fa-users text-xl"></i></div>
                 </div>
               </div>
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Bank Soal</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-soal">-</h3></div>
                   <div class="p-3 bg-green-50 text-green-600 rounded-lg"><i class="fas fa-book text-xl"></i></div>
                 </div>
               </div>
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-purple-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Ujian Masuk</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-nilai">-</h3></div>
                   <div class="p-3 bg-purple-50 text-purple-600 rounded-lg"><i class="fas fa-file-signature text-xl"></i></div>
                 </div>
               </div>
             </div>
             <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
               <h3 class="font-bold text-blue-800 text-lg mb-2">Selamat Datang!</h3>
               <p class="text-blue-700 text-sm md:text-base">Silakan pilih menu di samping untuk mengelola aplikasi.</p>
             </div>
          </div>

          <div id="view-bank-soal" class="hidden animate__animated animate__fadeIn">
            <div id="bs-list-section" class="w-full">
              <div class="bg-white p-4 md:p-5 rounded-xl shadow-sm border border-gray-200 mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                  <h2 class="text-xl md:text-2xl font-bold text-gray-800">Bank Soal</h2>
                  <p class="text-gray-500 text-sm">Kelola pertanyaan ujian.</p>
                </div>
                <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto items-center">
                  <button onclick="App.BankSoal.loadDaftar(true)" class="p-2 text-gray-500 hover:text-indigo-600 bg-white border rounded-lg shadow-sm" title="Refresh Soal">
                      <i id="btn-refresh-soal" class="fas fa-sync-alt"></i>
                  </button>
                  
                  <div class="w-full md:w-64">
                    <select id="filter-mapel" onchange="App.BankSoal.loadDaftar()" class="w-full p-2 border rounded-lg bg-gray-50 font-semibold text-gray-700 outline-none">
                      <option value="">- Tampilkan Semua -</option>
                    </select>
                  </div>
                  <button onclick="App.BankSoal.toggleForm(true)" class="w-full md:w-auto px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow font-bold">
                    <i class="fas fa-plus"></i> Buat Soal
                  </button>
                </div>
              </div>
              <div class="bg-white rounded-xl shadow border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[600px]">
                    <thead class="bg-slate-50 text-slate-600 uppercase text-xs font-bold">
                      <tr>
                        <th class="p-4 border-b w-16 text-center">No</th>
                        <th class="p-4 border-b w-24">Tipe</th>
                        <th class="p-4 border-b">Pertanyaan</th>
                        <th class="p-4 border-b w-16">Kunci</th>
                        <th class="p-4 border-b w-24 text-right">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-soal" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div id="bs-form-section" class="hidden">
              <div class="flex items-center gap-4 mb-4">
                <button onclick="App.BankSoal.toggleForm(false)" class="p-2 rounded-full bg-white border hover:bg-gray-100 text-gray-600 shadow-sm"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-lg md:text-xl font-bold text-gray-800" id="form-soal-title">Input Soal</h2>
              </div>
              <div class="bg-white rounded-xl shadow-md p-4 md:p-6 max-w-5xl mx-auto border border-gray-200">
                <form id="formSoal" onsubmit="App.BankSoal.submit(event)" class="space-y-6">
                  <input type="hidden" id="soal-id" name="id"> 
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div>
                      <label class="block font-semibold mb-1 text-sm text-gray-600">Kode Mapel</label>
                      <select name="mapel" id="soal-mapel-select" class="input-std bg-gray-50" required><option value="">-- Pilih --</option></select>
                    </div>
                    <div>
                      <label class="block font-semibold mb-1 text-sm text-gray-600">Tipe Soal</label>
                      <select name="tipe" id="tipe-soal" class="input-std bg-gray-50 font-bold text-indigo-700" onchange="App.BankSoal.changeType()">
                        <option value="PG">Pilihan Ganda</option>
                        <option value="ISIAN">Isian Singkat</option>
                        <option value="ESSAY">Uraian / Essay</option>
                        <option value="BS">Benar / Salah</option>
                        <option value="COCOK">Pencocokan</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label class="block font-semibold mb-1 text-sm text-gray-600">Pertanyaan</label>
                    <div id="editor-container" class="bg-white"></div>
                  </div>
                  <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <div id="area-pg" class="opsi-area">
                      <p class="text-xs font-bold text-gray-500 mb-3 uppercase">Pilihan Jawaban</p>
                      <div class="space-y-3">
                         <div class="flex flex-col gap-1"><div class="flex gap-2 items-center"><span class="w-6 font-bold text-center shrink-0">A</span><input type="text" id="pg-a" class="input-std text-sm" placeholder="Teks A"><input type="file" id="file-a" accept="image/*" class="hidden" onchange="App.BankSoal.handleImage(this, 'A')"><label for="file-a" class="btn-upload-opsi shrink-0"><i class="fas fa-image"></i></label></div><div id="prev-box-A" class="hidden pl-8 flex items-center gap-2"><img id="img-prev-A" class="img-opsi-preview" onclick="App.UI.zoomImg(this)"><button type="button" onclick="App.BankSoal.removeImage('A')" class="text-xs text-red-500 underline">Hapus</button></div></div>
                         <div class="flex flex-col gap-1"><div class="flex gap-2 items-center"><span class="w-6 font-bold text-center shrink-0">B</span><input type="text" id="pg-b" class="input-std text-sm" placeholder="Teks B"><input type="file" id="file-b" accept="image/*" class="hidden" onchange="App.BankSoal.handleImage(this, 'B')"><label for="file-b" class="btn-upload-opsi shrink-0"><i class="fas fa-image"></i></label></div><div id="prev-box-B" class="hidden pl-8 flex items-center gap-2"><img id="img-prev-B" class="img-opsi-preview" onclick="App.UI.zoomImg(this)"><button type="button" onclick="App.BankSoal.removeImage('B')" class="text-xs text-red-500 underline">Hapus</button></div></div>
                         <div class="flex flex-col gap-1"><div class="flex gap-2 items-center"><span class="w-6 font-bold text-center shrink-0">C</span><input type="text" id="pg-c" class="input-std text-sm" placeholder="Teks C"><input type="file" id="file-c" accept="image/*" class="hidden" onchange="App.BankSoal.handleImage(this, 'C')"><label for="file-c" class="btn-upload-opsi shrink-0"><i class="fas fa-image"></i></label></div><div id="prev-box-C" class="hidden pl-8 flex items-center gap-2"><img id="img-prev-C" class="img-opsi-preview" onclick="App.UI.zoomImg(this)"><button type="button" onclick="App.BankSoal.removeImage('C')" class="text-xs text-red-500 underline">Hapus</button></div></div>
                         <div class="flex flex-col gap-1"><div class="flex gap-2 items-center"><span class="w-6 font-bold text-center shrink-0">D</span><input type="text" id="pg-d" class="input-std text-sm" placeholder="Teks D"><input type="file" id="file-d" accept="image/*" class="hidden" onchange="App.BankSoal.handleImage(this, 'D')"><label for="file-d" class="btn-upload-opsi shrink-0"><i class="fas fa-image"></i></label></div><div id="prev-box-D" class="hidden pl-8 flex items-center gap-2"><img id="img-prev-D" class="img-opsi-preview" onclick="App.UI.zoomImg(this)"><button type="button" onclick="App.BankSoal.removeImage('D')" class="text-xs text-red-500 underline">Hapus</button></div></div>
                         <div class="flex flex-col gap-1"><div class="flex gap-2 items-center"><span class="w-6 font-bold text-center shrink-0 text-gray-400">E</span><input type="text" id="pg-e" class="input-std text-sm" placeholder="Opsional"><input type="file" id="file-e" accept="image/*" class="hidden" onchange="App.BankSoal.handleImage(this, 'E')"><label for="file-e" class="btn-upload-opsi shrink-0"><i class="fas fa-image"></i></label></div><div id="prev-box-E" class="hidden pl-8 flex items-center gap-2"><img id="img-prev-E" class="img-opsi-preview" onclick="App.UI.zoomImg(this)"><button type="button" onclick="App.BankSoal.removeImage('E')" class="text-xs text-red-500 underline">Hapus</button></div></div>
                      </div>
                      <div class="mt-4">
                        <label class="block text-xs font-bold text-gray-500 mb-1">Kunci Jawaban</label>
                        <select id="kunci-pg" class="input-std bg-white w-full md:w-32"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option></select>
                      </div>
                    </div>
                    <div id="area-isian" class="opsi-area hidden"><p class="text-sm text-gray-600 mb-2">Kunci jawaban singkat.</p><input type="text" id="kunci-isian" class="input-std border-indigo-300"></div>
                    <div id="area-essay" class="opsi-area hidden"><p class="text-sm text-yellow-600"><i class="fas fa-info-circle"></i> Koreksi manual oleh Guru.</p></div>
                    <div id="area-bs" class="opsi-area hidden">
                      <div class="flex gap-4"><label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="kunci_bs" value="BENAR" class="accent-green-600"> <span class="font-bold text-green-700">BENAR</span></label><label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="kunci_bs" value="SALAH" class="accent-red-600"> <span class="font-bold text-red-700">SALAH</span></label></div>
                    </div>
                    <div id="area-cocok" class="opsi-area hidden">
                      <div id="container-cocok" class="space-y-2 mb-3"></div><button type="button" onclick="App.BankSoal.addRowCocok()" class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded font-bold">+ Tambah</button>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3">
                    <button type="button" onclick="App.BankSoal.toggleForm(false)" class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-lg order-2 md:order-1">BATAL</button>
                    <button type="submit" id="btnSave" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg shadow order-1 md:order-2">SIMPAN SOAL</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div id="view-ujian" class="hidden animate__animated animate__fadeIn space-y-8">
            
            <div>
              <div class="flex justify-between items-center mb-4">
                <div>
                   <h3 class="text-lg font-bold text-gray-800">1. Nama Ujian</h3>
                   <p class="text-xs text-gray-500">Kelola master jenis ujian (Misal: PAS, PAT).</p>
                </div>
                <div class="flex gap-2">
                   <button onclick="App.Ujian.loadJenis(true)" class="p-2 bg-white border rounded hover:text-indigo-600"><i id="btn-refresh-ujian" class="fas fa-sync-alt"></i></button>
                   <button onclick="App.Ujian.openModalJenis()" class="px-3 py-2 bg-slate-700 text-white rounded text-sm font-bold shadow hover:bg-slate-800"><i class="fas fa-plus"></i> Buat Nama</button>
                </div>
              </div>
              <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[500px]">
                    <thead class="bg-slate-50 text-slate-600 uppercase text-xs">
                      <tr><th class="p-3">Nama Ujian</th><th class="p-3">Keterangan</th><th class="p-3">Status</th><th class="p-3 text-right">Aksi</th></tr>
                    </thead>
                    <tbody id="tbody-jenis-ujian" class="text-sm text-gray-700 divide-y"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div>
              <div class="flex justify-between items-center mb-4">
                <div>
                   <h3 class="text-lg font-bold text-gray-800">2. Set Ujian / Enrollment</h3>
                   <p class="text-xs text-gray-500">Hubungkan mapel ke ujian & atur jadwal.</p>
                </div>
                <button onclick="App.Ujian.openModalJadwal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold shadow hover:bg-indigo-700"><i class="fas fa-plus-circle"></i> Tambah Set Ujian</button>
              </div>
              <div class="bg-white rounded-xl shadow-md border overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[600px]">
                    <thead class="bg-indigo-50 text-indigo-800 uppercase text-xs">
                      <tr>
                        <th class="p-3">Ujian & Mapel</th>
                        <th class="p-3">Jadwal (Mulai - Selesai)</th>
                        <th class="p-3">Pengawas</th> <th class="p-3">Status</th>
                        <th class="p-3 text-right">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-jadwal" class="text-sm text-gray-700 divide-y"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <div id="view-akun" class="hidden animate__animated animate__fadeIn">
             <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
               <div class="flex bg-white rounded-lg p-1 shadow-sm border overflow-x-auto w-full md:w-auto no-scrollbar">
                 <button onclick="App.User.filterTab('all', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold bg-indigo-100 text-indigo-700">Semua</button>
                 <button onclick="App.User.filterTab('siswa', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Siswa</button>
                 <button onclick="App.User.filterTab('guru', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Guru</button>
                 <button onclick="App.User.filterTab('pengawas', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Pengawas</button>
                 <button onclick="App.User.filterTab('admin', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Admin</button>
               </div>
               <div class="flex gap-2 w-full md:w-auto">
                <button onclick="App.User.loadAll(true)" class="flex-1 md:flex-none px-4 py-2 bg-white border border-gray-300 text-gray-600 rounded-lg shadow-sm hover:text-indigo-600 transition" title="Refresh User">
                    <i id="btn-refresh-user" class="fas fa-sync-alt"></i>
                </button>
                <button onclick="App.User.modalOpen()" class="flex-1 md:flex-none px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> <span class="text-sm font-bold">User</span>
                </button>
               </div>
             </div>
             <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
               <div class="overflow-x-auto"><table class="w-full text-left border-collapse min-w-[600px]"><thead class="bg-gray-50 text-gray-600 uppercase text-xs"><tr><th class="p-4 border-b">Nama</th><th class="p-4 border-b">Role</th><th class="p-4 border-b">Kelas</th><th class="p-4 border-b">Status</th><th class="p-4 border-b text-right">Aksi</th></tr></thead><tbody id="tbody-users" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody></table></div>
             </div>
          </div>

          <div id="view-mapel" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl md:text-2xl font-bold text-gray-800">Mapel</h2>
              
              <div class="flex gap-2">
                  <button onclick="App.Mapel.load(true)" class="px-3 py-2 bg-white border border-gray-300 text-gray-600 rounded-lg shadow-sm hover:text-indigo-600 transition" title="Refresh Mapel">
                      <i id="btn-refresh-mapel" class="fas fa-sync-alt"></i>
                  </button>

                  <button onclick="App.Mapel.modalOpen()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-lg flex items-center gap-2 font-semibold text-sm">
                      <i class="fas fa-plus-circle"></i> Tambah
                  </button>
              </div>
            </div>
            <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
              <div class="overflow-x-auto"><table class="w-full text-left border-collapse min-w-[500px]"><thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold"><tr><th class="p-4 border-b">Kode</th><th class="p-4 border-b">Nama Mapel</th><th class="p-4 border-b">Guru</th><th class="p-4 border-b text-right">Aksi</th></tr></thead><tbody id="tbody-mapel" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody></table></div>
            </div>
          </div>

          <div id="view-jadwal-siswa" class="hidden animate__animated animate__fadeIn">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Jadwal Ujian Aktif</h2>
            <div class="bg-white rounded-xl shadow p-4">
              <div id="list-ujian-siswa" class="space-y-4">
                  <p class="text-gray-400 text-center">Memuat jadwal...</p>
              </div>
            </div>
          </div>

          <div id="view-hasil-ujian" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-xl font-bold text-gray-800">Rekap Nilai</h2>
              <select id="filter-hasil-mapel" class="input-std w-48"><option value="">- Pilih Mapel -</option></select>
            </div>
            <div class="bg-white rounded-xl shadow overflow-hidden">
              <table class="w-full text-left"><thead class="bg-gray-50"><tr><th class="p-3">Siswa</th><th class="p-3">Mapel</th><th class="p-3">Nilai</th><th class="p-3">Status</th></tr></thead><tbody id="tbody-hasil"></tbody></table>
            </div>
          </div>

          <div id="view-pengawas" class="hidden animate__animated animate__fadeIn space-y-6">
            
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 text-white shadow-lg flex flex-col items-center justify-center relative overflow-hidden transition-all duration-300" id="box-token-pengawas">
              <div class="absolute top-0 right-0 p-4 opacity-20"><i class="fas fa-key text-8xl"></i></div>
              <p class="text-indigo-100 text-sm font-semibold uppercase tracking-wider mb-2" id="label-token-pengawas">Pilih Ujian Terlebih Dahulu</p>
              <h1 id="token-display" class="text-4xl md:text-5xl font-black tracking-widest font-mono">-- -- --</h1>
            </div>

            <div class="bg-white rounded-xl shadow border p-4">
              <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="font-bold text-gray-700"><i class="fas fa-desktop text-indigo-500"></i> Monitoring Siswa</h3>
                <select id="mon-pilih-jadwal" onchange="App.Pengawas.loadMonitoring()" class="input-std text-sm w-64 bg-gray-50"></select>
              </div>
              <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                  <thead class="bg-slate-50 text-slate-600">
                    <tr><th class="p-3">Nama Siswa</th><th class="p-3">Kelas</th><th class="p-3 text-center">Status</th><th class="p-3 text-center">Aksi</th></tr>
                  </thead>
                  <tbody id="tbody-monitoring" class="divide-y"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-admin-monitoring" class="hidden animate__animated animate__fadeIn">
             <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                
                <div class="lg:col-span-4 bg-white rounded-xl shadow border border-gray-200 flex flex-col h-[600px] overflow-hidden sticky top-6">
                   <div class="p-4 border-b bg-gray-50 flex justify-between items-center shrink-0">
                      <div>
                        <h3 class="font-bold text-gray-700"><i class="fas fa-list"></i> Ujian Aktif</h3>
                        <p class="text-[10px] text-gray-400">Pilih ujian untuk melihat detail</p>
                      </div>
                      <button onclick="App.AdminMonitor.loadSummary()" class="text-gray-500 hover:text-indigo-600 p-2"><i class="fas fa-sync-alt"></i></button>
                   </div>
                   <div id="adm-list-exams" class="overflow-y-auto flex-1 p-3 space-y-3 bg-gray-50 scroll-smooth"></div>
                </div>

                <div class="lg:col-span-8 flex flex-col gap-6">
                   
                   <div class="bg-white rounded-xl shadow border border-gray-200 flex flex-col min-h-[500px] relative">
                       <div class="p-4 border-b bg-indigo-600 text-white flex justify-between items-center z-10 shrink-0">
                          <div>
                             <h3 class="font-bold text-lg" id="adm-mon-title">Pilih Ujian</h3>
                             <p class="text-xs text-indigo-200" id="adm-mon-subtitle">Klik list di samping kiri</p>
                          </div>
                          <div class="text-right hidden" id="adm-header-stats">
                              <span class="block text-2xl font-mono font-black tracking-widest text-yellow-300" id="adm-mon-token">---</span>
                              <span class="text-[10px] uppercase font-bold text-indigo-200">Token Ujian Ini</span>
                          </div>
                       </div>
                       <div class="flex-1 overflow-auto bg-white">
                          <table class="w-full text-left text-sm border-collapse">
                             <thead class="bg-slate-100 text-slate-600 sticky top-0 z-10 shadow-sm">
                                <tr>
                                   <th class="p-3 border-b">Nama Siswa</th>
                                   <th class="p-3 border-b text-center">Kelas</th>
                                   <th class="p-3 border-b text-center">Status</th>
                                   <th class="p-3 border-b text-center">Aksi</th>
                                </tr>
                             </thead>
                             <tbody id="tbody-adm-monitoring" class="divide-y divide-gray-100">
                                <tr><td colspan="4" class="p-10 text-center text-gray-400">Belum ada data.</td></tr>
                             </tbody>
                          </table>
                       </div>
                   </div>

                   <div class="bg-red-50 rounded-xl shadow border border-red-200 h-48 flex flex-col shrink-0 overflow-hidden">
                      <div class="px-4 py-2 border-b border-red-200 bg-red-100 flex justify-between items-center shrink-0">
                         <h4 class="text-sm font-bold text-red-800 uppercase flex items-center gap-2">
                            <i class="fas fa-exclamation-circle text-red-600"></i> Menu Pelanggaran / Buka Kunci
                         </h4>
                         <span id="badge-locked-count" class="bg-red-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold hidden">0</span>
                      </div>
                      <div id="list-adm-locked" class="p-3 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3 content-start">
                         <p class="text-xs text-gray-400 italic w-full text-center col-span-full mt-4">Tidak ada siswa yang terkunci saat ini.</p>
                      </div>
                   </div>

                </div>
             </div>
          </div>

          <div id="view-admin-hasil" class="hidden animate__animated animate__fadeIn">
             <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">Hasil Ujian</h2>
                <div class="flex gap-2 w-full md:w-auto">
                   <select id="filter-hasil-admin" onchange="App.AdminHasil.load()" class="input-std w-full md:w-64">
                      <option value="">- Semua Mapel -</option>
                   </select>
                   <button onclick="App.AdminHasil.load(true)" class="px-4 py-2 bg-white border rounded shadow hover:text-indigo-600">
                      <i class="fas fa-sync-alt"></i>
                   </button>
                </div>
             </div>
             <div class="bg-white rounded-xl shadow overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                   <table class="w-full text-left border-collapse min-w-[600px]">
                      <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold">
                         <tr>
                            <th class="p-4 border-b">Waktu Submit</th>
                            <th class="p-4 border-b">Nama Siswa</th>
                            <th class="p-4 border-b">Mapel</th>
                            <th class="p-4 border-b text-center">Benar / Total</th>
                            <th class="p-4 border-b text-center">Nilai Akhir</th>
                         </tr>
                      </thead>
                      <tbody id="tbody-hasil-admin" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody>
                   </table>
                </div>
             </div>
          </div>

        </div>
      </main>
    </div>

    <div id="page-siswa" class="hidden fixed inset-0 z-50 bg-gray-100 flex flex-col font-sans h-full overflow-hidden">
        <header class="bg-slate-900 text-white px-4 py-3 flex justify-between items-center z-20 shrink-0 shadow-md">
             <div class="flex items-center gap-3 overflow-hidden">
               <div class="w-8 h-8 md:w-10 md:h-10 bg-indigo-600 rounded-full flex items-center justify-center font-bold text-sm md:text-base shrink-0">S</div>
               <div class="min-w-0"><h1 class="font-bold text-sm truncate" id="header-nama">Siswa</h1><p class="text-[10px] md:text-xs text-gray-400 truncate" id="header-mapel">-</p></div>
             </div>
             <div class="bg-slate-800 px-3 py-1 rounded text-base md:text-lg font-mono font-bold text-yellow-400 shrink-0" id="timer-display">--:--</div>
        </header>
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative" id="main-exam-area">
             <aside class="hidden md:flex w-64 bg-white border-r flex-col z-30 shrink-0 order-2 md:order-1 h-full shadow-lg">
                <div class="p-3 border-b font-bold text-center bg-gray-50">Navigasi Soal</div>
                <div class="flex-1 p-3 overflow-y-auto"><div id="grid-nomor" class="grid grid-cols-5 gap-2"></div></div>
                <div class="p-3 border-t"><button onclick="App.Exam.finish()" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded font-bold transition">SELESAI</button></div>
             </aside>
             
             <div class="flex-1 flex flex-col relative w-full h-full order-1 md:order-2">
                 <div id="exam-loading" class="flex flex-col items-center justify-center h-full text-gray-500 absolute inset-0 bg-gray-100 z-10"><i class="fas fa-spinner fa-spin text-3xl mb-2"></i> <p>Memuat Soal...</p></div>
                 <div id="soal-container" class="hidden flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50">
                    <div class="max-w-3xl mx-auto bg-white rounded-lg shadow p-4 md:p-6 min-h-full md:min-h-0">
                        <div class="flex justify-between mb-3"><span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs md:text-sm font-bold">No. <span id="disp-no">1</span></span></div>
                        <div id="disp-pertanyaan" class="text-base md:text-lg mb-4 text-gray-800 leading-relaxed"></div>
                        <div id="disp-gambar-container" class="hidden mb-4 flex justify-center bg-gray-100 rounded border p-2"><img id="disp-gambar" class="rounded max-h-[40vh] md:max-h-80"></div>
                        <div id="disp-opsi" class="space-y-2 pb-20 md:pb-0"></div>
                    </div>
                 </div>
                 <div id="nav-buttons" class="hidden shrink-0 bg-white border-t p-3 flex justify-between items-center shadow-top z-20">
                    <button onclick="App.Exam.prev()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 border rounded-lg text-sm font-bold text-gray-700 w-24"><i class="fas fa-chevron-left"></i> Prev</button>
                    <button onclick="App.Exam.toggleRagu()" class="px-3 py-2 bg-yellow-50 text-yellow-600 border border-yellow-200 rounded-lg text-xs md:text-sm font-bold flex flex-col items-center leading-none gap-1"><i class="fas fa-bookmark"></i> <span>Ragu</span></button>
                    <button onclick="App.Exam.next()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-bold w-24 shadow-md">Next <i class="fas fa-chevron-right"></i></button>
                 </div>
             </div>
        </main>
    </div>

    <div id="modal-mapel" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6 animate__animated animate__zoomIn">
          <div class="flex justify-between items-center mb-5 border-b pb-3"><h3 class="text-xl font-bold text-gray-800" id="modal-mapel-title">Tambah Mapel</h3><button onclick="App.UI.closeModal('modal-mapel')" class="text-gray-400"><i class="fas fa-times"></i></button></div>
          <form onsubmit="App.Mapel.save(event)" class="space-y-4">
             <input type="hidden" id="m-id">
             <div><label class="text-xs font-bold text-gray-500">Kode</label><input type="text" id="m-kode" class="input-std uppercase" required></div>
             <div><label class="text-xs font-bold text-gray-500">Nama</label><input type="text" id="m-nama" class="input-std" required></div>
             <div><label class="text-xs font-bold text-gray-500">Guru</label><select id="m-guru" class="input-std bg-gray-50"><option value="-">- Pilih -</option></select></div>
             <div class="pt-4 flex justify-end gap-3"><button type="button" onclick="App.UI.closeModal('modal-mapel')" class="px-4 py-2 bg-gray-100 rounded-lg">Batal</button><button type="submit" id="btnSimpanMapel" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">Simpan</button></div>
          </form>
       </div>
    </div>

    <div id="modal-user" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
      <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 animate__animated animate__zoomIn max-h-screen overflow-y-auto">
        <div class="flex justify-between items-center mb-5 border-b pb-3"><h3 class="text-xl font-bold text-gray-800" id="modal-title">User</h3><button onclick="App.UI.closeModal('modal-user')" class="text-gray-400"><i class="fas fa-times"></i></button></div>
        <form onsubmit="App.User.save(event)" class="space-y-4">
           <input type="hidden" id="u-id">
           <div class="grid grid-cols-2 gap-4"><div><label class="text-xs font-bold text-gray-500">Role</label><select id="u-role" class="input-std" onchange="App.User.toggleKelasInput()" required><option value="siswa">Siswa</option><option value="guru">Guru</option><option value="pengawas">Pengawas</option><option value="admin">Admin</option></select></div><div><label class="text-xs font-bold text-gray-500">Status</label><select id="u-status" class="input-std"><option value="Aktif">Aktif</option><option value="Nonaktif">Banned</option></select></div></div>
           <div><label class="text-xs font-bold text-gray-500">Nama Lengkap</label><input type="text" id="u-nama" class="input-std" required></div>
           <div class="grid grid-cols-2 gap-4"><div><label class="text-xs font-bold text-gray-500">Username</label><input type="text" id="u-username" class="input-std" required></div><div><label class="text-xs font-bold text-gray-500">Password</label><input type="text" id="u-password" class="input-std" required></div></div>
           <div id="div-kelas"><label class="text-xs font-bold text-gray-500">Kelas</label><input type="text" id="u-kelas" class="input-std"></div>
           <div class="pt-4 flex justify-end gap-3"><button type="button" onclick="App.UI.closeModal('modal-user')" class="px-4 py-2 bg-gray-100 rounded-lg">Batal</button><button type="submit" id="btnSimpanUser" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">Simpan</button></div>
        </form>
      </div>
    </div>

    <div id="modal-jenis" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-sm rounded-xl shadow-2xl p-6">
          <div class="flex justify-between mb-4 border-b pb-2"><h3 class="font-bold text-lg" id="modal-jenis-title">Nama Ujian</h3><button onclick="App.UI.closeModal('modal-jenis')"><i class="fas fa-times"></i></button></div>
          <form id="formJenis" onsubmit="App.Ujian.saveJenis(event)" class="space-y-3">
             <input type="hidden" id="j-id">
             <div><label class="text-xs font-bold text-gray-500">Nama Event</label><input type="text" id="j-nama" class="input-std" placeholder="Contoh: PAS Ganjil 2024" required></div>
             <div><label class="text-xs font-bold text-gray-500">Keterangan</label><input type="text" id="j-ket" class="input-std" placeholder="Opsional"></div>
             <div><label class="text-xs font-bold text-gray-500">Status</label><select id="j-status" class="input-std"><option value="Aktif">Aktif</option><option value="Nonaktif">Nonaktif</option></select></div>
             <div class="pt-2 text-right"><button type="submit" id="btnSimpanJenis" class="px-4 py-2 bg-slate-700 text-white rounded font-bold">Simpan</button></div>
          </form>
       </div>
    </div>

    <div id="modal-jadwal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6">
          <div class="flex justify-between mb-4 border-b pb-2"><h3 class="font-bold text-lg" id="modal-jadwal-title">Set Ujian</h3><button onclick="App.UI.closeModal('modal-jadwal')"><i class="fas fa-times"></i></button></div>
          <form id="formJadwal" onsubmit="App.Ujian.saveJadwal(event)" class="space-y-3">
             <input type="hidden" id="sch-id">
             
             <div><label class="text-xs font-bold text-gray-500">Pilih Nama Ujian</label><select id="sch-jenis" class="input-std bg-gray-50" required><option value="">Loading...</option></select></div>
             
             <div><label class="text-xs font-bold text-gray-500">Pilih Mapel / Bank Soal</label><select id="sch-mapel" class="input-std bg-gray-50" required><option value="">Loading...</option></select></div>
             
             <div class="grid grid-cols-2 gap-3">
               <div><label class="text-xs font-bold text-gray-500">Mulai</label><input type="datetime-local" id="sch-mulai" class="input-std" required></div>
               <div><label class="text-xs font-bold text-gray-500">Selesai</label><input type="datetime-local" id="sch-selesai" class="input-std" required></div>
             </div>

             <div><label class="text-xs font-bold text-gray-500">Status Enrollment</label><select id="sch-status" class="input-std"><option value="Aktif">Aktif (Bisa dikerjakan)</option><option value="Nonaktif">Nonaktif / Tutup</option></select></div>

             <div>
               <label class="text-xs font-bold text-gray-500">Pilih Pengawas</label>
               <select id="sch-pengawas" class="input-std bg-gray-50">
                 <option value="">Loading...</option>
               </select>
               <p class="text-[10px] text-gray-400 mt-1">*Pilih "Semua" jika ujian bisa diawasi siapa saja.</p>
             </div>

             <div class="pt-4 text-right"><button type="submit" id="btnSimpanJadwal" class="px-6 py-2 bg-indigo-600 text-white rounded font-bold shadow">Simpan Enrollment</button></div>
          </form>
       </div>
    </div>

    <div id="lock-screen" class="hidden fixed inset-0 z-[100] bg-red-900 flex items-center justify-center text-white text-center p-6">
       <div class="max-w-md w-full">
         <i class="fas fa-lock text-5xl mb-4 animate-bounce"></i>
         <h2 class="text-2xl font-bold mb-2">TERKUNCI!</h2>
         <p id="lock-reason" class="mb-4 text-red-200">Keluar aplikasi.</p>
         <input type="password" id="token-unlock" class="w-full p-3 text-black text-center text-xl font-bold rounded-lg mb-4 outline-none focus:ring-4 ring-red-500" placeholder="TOKEN PENGAWAS">
         <button onclick="App.Security.unlock()" id="btnUnlock" class="w-full py-3 bg-white text-red-900 font-bold rounded-lg shadow-lg">BUKA KUNCI</button>
       </div>
    </div>

    <?!= include('JavaScript'); ?>
  </body>
</html>
