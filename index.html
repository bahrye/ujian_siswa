<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CBT SYSTEM PRO</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>
    
    <?!= include('Stylesheet'); ?>
  </head>
  <body>

    <div id="login-container" class="min-h-[100dvh] flex items-center justify-center bg-slate-900 p-4">
      <div class="glass-panel w-full max-w-sm p-8 rounded-xl shadow-2xl">
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-indigo-600 rounded-lg mx-auto flex items-center justify-center mb-3">
            <i class="fas fa-laptop-code text-white text-3xl"></i>
          </div>
          <h1 class="text-2xl font-bold text-slate-800">CBT LOGIN</h1>
          <p class="text-gray-500 text-xs">Admin • Guru • Pengawas • Siswa</p>
        </div>
        <form onsubmit="App.Auth.login(event)" class="space-y-4">
          <input type="text" id="user" class="input-std" placeholder="Username" required>
          <input type="password" id="pass" class="input-std" placeholder="Password" required>
          <button type="submit" id="btnLogin" class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded transition">
            MASUK
          </button>
        </form>
      </div>
    </div>

    <div id="dashboard-container" class="hidden flex h-[100dvh] overflow-hidden bg-gray-100 relative">
      
      <div id="sidebar-backdrop" onclick="App.UI.toggleSidebar()" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden glass-panel"></div>

      <aside id="sidebar-panel" class="absolute md:static inset-y-0 left-0 w-64 bg-slate-900 text-white flex flex-col shadow-xl z-30 transform -translate-x-full md:translate-x-0 sidebar-transition">
        <div class="h-16 flex items-center justify-between px-6 border-b border-slate-700 font-bold text-lg tracking-wider">
          <span><i class="fas fa-graduation-cap text-indigo-400"></i> CBT ADMIN</span>
          <button onclick="App.UI.toggleSidebar()" class="md:hidden text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>

        <div class="p-4 border-b border-slate-800">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-lg">
              <span id="dash-initial">A</span>
            </div>
            <div class="overflow-hidden">
              <p class="text-sm font-semibold truncate" id="dash-nama">User</p>
              <p class="text-xs text-indigo-300 uppercase" id="dash-role">Role</p>
            </div>
          </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1" id="sidebar-menu"></nav>

        <div class="p-4 border-t border-slate-800">
          <button onclick="App.Auth.logout()" class="flex items-center gap-3 w-full px-4 py-2 text-red-400 hover:bg-slate-800 rounded transition">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </aside>

      <main class="flex-1 flex flex-col overflow-hidden relative w-full">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-4 md:px-6 z-10 shrink-0">
          <div class="flex items-center gap-3">
             <button onclick="App.UI.toggleSidebar()" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded">
               <i class="fas fa-bars text-xl"></i>
             </button>
             <h2 class="text-lg md:text-xl font-bold text-gray-700 truncate" id="page-title">Dashboard</h2>
          </div>
          <div class="text-xs md:text-sm text-gray-500 text-right" id="current-date"></div>
        </header>

        <div class="flex-1 overflow-auto p-4 md:p-6 scroll-smooth w-full" id="main-view-area" style="-webkit-overflow-scrolling: touch;">
          
          <div id="view-dashboard" class="space-y-6 animate__animated animate__fadeIn">
             <div class="flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-700">Statistik Sistem</h3>
                <button onclick="App.Dashboard.loadStats(true)" class="text-gray-500 hover:text-indigo-600 transition" title="Refresh Data">
                    <i id="btn-refresh-dash" class="fas fa-sync-alt"></i>
                </button>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Total Pengguna</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-user">-</h3></div>
                   <div class="p-3 bg-blue-50 text-blue-600 rounded-lg"><i class="fas fa-users text-xl"></i></div>
                 </div>
               </div>
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Bank Soal</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-soal">-</h3></div>
                   <div class="p-3 bg-green-50 text-green-600 rounded-lg"><i class="fas fa-book text-xl"></i></div>
                 </div>
               </div>
               <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-purple-500">
                 <div class="flex justify-between items-start">
                   <div><p class="text-gray-500 text-sm">Ujian Masuk</p><h3 class="text-3xl font-bold text-gray-800 mt-1" id="stat-nilai">-</h3></div>
                   <div class="p-3 bg-purple-50 text-purple-600 rounded-lg"><i class="fas fa-file-signature text-xl"></i></div>
                 </div>
               </div>
             </div>
             <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
               <h3 class="font-bold text-blue-800 text-lg mb-2">Selamat Datang!</h3>
               <p class="text-blue-700 text-sm md:text-base">Silakan pilih menu di samping untuk mengelola aplikasi.</p>
             </div>
          </div>

          <div id="view-bank-soal" class="hidden animate__animated animate__fadeIn">
            <div id="bs-list-section" class="w-full">
              <div class="bg-white p-4 md:p-5 rounded-xl shadow-sm border border-gray-200 mb-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                  <h2 class="text-xl md:text-2xl font-bold text-gray-800">Bank Soal</h2>
                  <p class="text-gray-500 text-sm">Kelola pertanyaan ujian.</p>
                </div>
                <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto items-center">
                  <button onclick="App.BankSoal.loadDaftar(true)" class="p-2 text-gray-500 hover:text-indigo-600 bg-white border rounded-lg shadow-sm" title="Refresh Soal">
                      <i id="btn-refresh-soal" class="fas fa-sync-alt"></i>
                  </button>
                  
                  <div class="w-full md:w-64">
                    <select id="filter-mapel" onchange="App.BankSoal.loadDaftar()" class="w-full p-2 border rounded-lg bg-gray-50 font-semibold text-gray-700 outline-none">
                      <option value="">- Tampilkan Semua -</option>
                    </select>
                  </div>
                  <button onclick="App.BankSoal.toggleForm(true)" class="w-full md:w-auto px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow font-bold">
                    <i class="fas fa-plus"></i> Buat Soal
                  </button>
                  <button onclick="App.BankSoal.openImportModal()" class="w-full md:w-auto px-4 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow font-bold flex items-center justify-center gap-2">
                    <i class="fas fa-file-excel"></i> Import Excel
                  </button>
                </div>
              </div>
              <div class="bg-white rounded-xl shadow border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[600px]">
                    <thead class="bg-slate-50 text-slate-600 uppercase text-xs font-bold">
                      <tr>
                        <th class="p-4 border-b w-16 text-center">No</th>
                        <th class="p-4 border-b w-24">Tipe</th>
                        <th class="p-4 border-b">Pertanyaan</th>
                        <th class="p-4 border-b w-16">Kunci</th>
                        <th class="p-4 border-b w-24 text-right">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-soal" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div id="bs-form-section" class="hidden">
              <div class="flex items-center gap-4 mb-4">
                <button onclick="App.BankSoal.toggleForm(false)" class="p-2 rounded-full bg-white border hover:bg-gray-100 text-gray-600 shadow-sm"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-lg md:text-xl font-bold text-gray-800" id="form-soal-title">Input Soal</h2>
              </div>
              <div class="bg-white rounded-xl shadow-md p-4 md:p-6 max-w-5xl mx-auto border border-gray-200">
                <form id="formSoal" onsubmit="App.BankSoal.submit(event)" class="space-y-6">
                  <input type="hidden" id="soal-id" name="id"> 
                  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6">
                    <div class="md:col-span-5">
                      <label class="block font-semibold mb-1 text-sm text-gray-600">Kode Mapel</label>
                      <select name="mapel" id="soal-mapel-select" class="input-std bg-gray-50" required><option value="">-- Pilih --</option></select>
                    </div>

                    <div class="md:col-span-4">
                      <label class="block font-semibold mb-1 text-sm text-gray-600">Tipe Soal</label>
                      <select name="tipe" id="tipe-soal" class="input-std bg-gray-50 font-bold text-indigo-700" onchange="App.BankSoal.changeType()">
                        <option value="PG">Pilihan Ganda</option>
                        <option value="ISIAN">Isian Singkat</option>
                        <option value="ESSAY">Uraian / Essay</option>
                        <option value="BS">Benar / Salah</option>
                        <option value="COCOK">Pencocokan</option>
                      </select>
                    </div>

                    <div class="md:col-span-3">
                       <label class="block font-semibold mb-1 text-sm text-gray-600">Bobot Nilai</label>
                       <input type="number" id="soal-bobot" class="input-std" placeholder="Opsional (mis: 2.5)">
                    </div>
                  </div>
                  <div>
                    <label class="block font-semibold mb-1 text-sm text-gray-600">Pertanyaan</label>
                    
                    <div class="flex gap-2 mb-2">
                      <button type="button" onclick="App.BankSoal.triggerMedia('image')" class="px-3 py-1.5 bg-gray-100 border border-gray-300 rounded text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 text-sm font-bold flex items-center gap-2 transition">
                        <i class="fas fa-image"></i> Upload Gambar
                      </button>
                      
                      <input type="file" id="q-media-input" class="hidden" accept="image/*" onchange="App.BankSoal.handleEditorMedia(this)">
                      
                      <div class="text-xs text-gray-400 flex items-center ml-2">
                        *Untuk Audio/Video, gunakan tombol Link/Video di toolbar editor.
                      </div>
                    </div>

                    <div id="editor-container" class="bg-white rounded-b-lg"></div>
                  </div>
                  <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <div id="area-pg" class="opsi-area">
                      <p class="text-xs font-bold text-gray-500 mb-3 uppercase">Pilihan Jawaban (Gambar)</p>
                      <div class="space-y-4">
                         <div class="flex flex-col gap-2 p-3 border rounded-lg bg-gray-50">
                            <div class="flex gap-2 items-center">
                               <input type="hidden" id="existing-media-a">
                               <span class="w-6 font-bold text-center shrink-0">A</span>
                               <input type="text" id="pg-a" class="input-std text-sm" placeholder="Teks Jawaban A">
                               <input type="file" id="file-a" accept="image/*" class="hidden" onchange="App.BankSoal.handleMedia(this, 'A')">
                               <label for="file-a" class="btn-upload-opsi shrink-0" title="Upload Media"><i class="fas fa-paperclip"></i></label>
                            </div>
                            <div id="prev-box-A" class="hidden pl-8 flex flex-col gap-2">
                               <div id="media-content-A" class="w-full max-w-[200px]"></div>
                               <button type="button" onclick="App.BankSoal.removeMedia('A')" class="text-xs text-red-500 underline text-left">Hapus Media</button>
                            </div>
                         </div>

                         <div class="flex flex-col gap-2 p-3 border rounded-lg bg-gray-50">
                            <div class="flex gap-2 items-center">
                               <input type="hidden" id="existing-media-b">
                               <span class="w-6 font-bold text-center shrink-0">B</span>
                               <input type="text" id="pg-b" class="input-std text-sm" placeholder="Teks Jawaban B">
                               <input type="file" id="file-b" accept="image/*" class="hidden" onchange="App.BankSoal.handleMedia(this, 'B')">
                               <label for="file-b" class="btn-upload-opsi shrink-0"><i class="fas fa-paperclip"></i></label>
                            </div>
                            <div id="prev-box-B" class="hidden pl-8 flex flex-col gap-2">
                               <div id="media-content-B" class="w-full max-w-[200px]"></div>
                               <button type="button" onclick="App.BankSoal.removeMedia('B')" class="text-xs text-red-500 underline text-left">Hapus Media</button>
                            </div>
                         </div>

                         <div class="flex flex-col gap-2 p-3 border rounded-lg bg-gray-50">
                            <div class="flex gap-2 items-center">
                               <input type="hidden" id="existing-media-c">
                               <span class="w-6 font-bold text-center shrink-0">C</span>
                               <input type="text" id="pg-c" class="input-std text-sm" placeholder="Teks Jawaban C">
                               <input type="file" id="file-c" accept="image/*" class="hidden" onchange="App.BankSoal.handleMedia(this, 'C')">
                               <label for="file-c" class="btn-upload-opsi shrink-0"><i class="fas fa-paperclip"></i></label>
                            </div>
                            <div id="prev-box-C" class="hidden pl-8 flex flex-col gap-2">
                               <div id="media-content-C" class="w-full max-w-[200px]"></div>
                               <button type="button" onclick="App.BankSoal.removeMedia('C')" class="text-xs text-red-500 underline text-left">Hapus Media</button>
                            </div>
                         </div>

                         <div class="flex flex-col gap-2 p-3 border rounded-lg bg-gray-50">
                            <div class="flex gap-2 items-center">
                               <input type="hidden" id="existing-media-d">
                               <span class="w-6 font-bold text-center shrink-0">D</span>
                               <input type="text" id="pg-d" class="input-std text-sm" placeholder="Teks Jawaban D">
                               <input type="file" id="file-d" accept="image/*" class="hidden" onchange="App.BankSoal.handleMedia(this, 'D')">
                               <label for="file-d" class="btn-upload-opsi shrink-0"><i class="fas fa-paperclip"></i></label>
                            </div>
                            <div id="prev-box-D" class="hidden pl-8 flex flex-col gap-2">
                               <div id="media-content-D" class="w-full max-w-[200px]"></div>
                               <button type="button" onclick="App.BankSoal.removeMedia('D')" class="text-xs text-red-500 underline text-left">Hapus Media</button>
                            </div>
                         </div>

                         <div class="flex flex-col gap-2 p-3 border rounded-lg bg-gray-50">
                            <div class="flex gap-2 items-center">
                               <input type="hidden" id="existing-media-e">
                               <span class="w-6 font-bold text-center shrink-0 text-gray-400">E</span>
                               <input type="text" id="pg-e" class="input-std text-sm" placeholder="Opsional">
                               <input type="file" id="file-e" accept="image/*" class="hidden" onchange="App.BankSoal.handleMedia(this, 'E')">
                               <label for="file-e" class="btn-upload-opsi shrink-0"><i class="fas fa-paperclip"></i></label>
                            </div>
                            <div id="prev-box-E" class="hidden pl-8 flex flex-col gap-2">
                               <div id="media-content-E" class="w-full max-w-[200px]"></div>
                               <button type="button" onclick="App.BankSoal.removeMedia('E')" class="text-xs text-red-500 underline text-left">Hapus Media</button>
                            </div>
                         </div>
                      </div>
                      <div class="mt-4">
                        <label class="block text-xs font-bold text-gray-500 mb-1">Kunci Jawaban</label>
                        <select id="kunci-pg" class="input-std bg-white w-full md:w-32"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option></select>
                      </div>
                    </div>
                    <div id="area-isian" class="opsi-area hidden"><p class="text-sm text-gray-600 mb-2">Kunci jawaban singkat.</p><input type="text" id="kunci-isian" class="input-std border-indigo-300"></div>
                    <div id="area-essay" class="opsi-area hidden"><p class="text-sm text-yellow-600"><i class="fas fa-info-circle"></i> Koreksi manual oleh Guru.</p></div>
                    <div id="area-bs" class="opsi-area hidden">
                      <div class="flex gap-4"><label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="kunci_bs" value="BENAR" class="accent-green-600"> <span class="font-bold text-green-700">BENAR</span></label><label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="kunci_bs" value="SALAH" class="accent-red-600"> <span class="font-bold text-red-700">SALAH</span></label></div>
                    </div>
                    <div id="area-cocok" class="opsi-area hidden">
                      <div id="container-cocok" class="space-y-2 mb-3"></div><button type="button" onclick="App.BankSoal.addRowCocok()" class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded font-bold">+ Tambah</button>
                    </div>
                  </div>
                  <div class="flex flex-col md:flex-row gap-3">
                    <button type="button" onclick="App.BankSoal.toggleForm(false)" class="w-full py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-lg order-2 md:order-1">BATAL</button>
                    <button type="submit" id="btnSave" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-lg shadow order-1 md:order-2">SIMPAN SOAL</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div id="view-ujian" class="hidden animate__animated animate__fadeIn space-y-8">
            
            <div>
              <div class="flex justify-between items-center mb-4">
                <div>
                   <h3 class="text-lg font-bold text-gray-800">1. Nama Ujian</h3>
                   <p class="text-xs text-gray-500">Kelola master jenis ujian (Misal: PAS, PAT).</p>
                </div>
                <div class="flex gap-2">
                   <button onclick="App.Ujian.loadJenis(true)" class="p-2 bg-white border rounded hover:text-indigo-600"><i id="btn-refresh-ujian" class="fas fa-sync-alt"></i></button>
                   <button onclick="App.Ujian.openModalJenis()" class="px-3 py-2 bg-slate-700 text-white rounded text-sm font-bold shadow hover:bg-slate-800"><i class="fas fa-plus"></i> Buat Nama</button>
                </div>
              </div>
              <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[500px]">
                    <thead class="bg-slate-50 text-slate-600 uppercase text-xs">
                      <tr><th class="p-3">Nama Ujian</th><th class="p-3">Keterangan</th><th class="p-3">Status</th><th class="p-3 text-right">Aksi</th></tr>
                    </thead>
                    <tbody id="tbody-jenis-ujian" class="text-sm text-gray-700 divide-y"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div>
              <div class="flex justify-between items-center mb-4">
                <div>
                   <h3 class="text-lg font-bold text-gray-800">2. Set Ujian / Enrollment</h3>
                   <p class="text-xs text-gray-500">Hubungkan mapel ke ujian & atur jadwal.</p>
                </div>
                <button onclick="App.Ujian.openModalJadwal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold shadow hover:bg-indigo-700"><i class="fas fa-plus-circle"></i> Tambah Set Ujian</button>
              </div>
              <div class="bg-white rounded-xl shadow-md border overflow-hidden">
                <div class="overflow-x-auto">
                  <table class="w-full text-left border-collapse min-w-[600px]">
                    <thead class="bg-indigo-50 text-indigo-800 uppercase text-xs">
                      <tr>
                        <th class="p-3">Ujian & Mapel</th>
                        <th class="p-3">Jadwal (Mulai - Selesai)</th>
                        <th class="p-3">Pengawas</th> 
                        <th class="p-3">Kelas</th> <th class="p-3">Status</th>
                        <th class="p-3 text-right">Aksi</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-jadwal" class="text-sm text-gray-700 divide-y"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          
          <div id="view-akun" class="hidden animate__animated animate__fadeIn">
             <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
               <div class="flex bg-white rounded-lg p-1 shadow-sm border overflow-x-auto w-full md:w-auto no-scrollbar">
                 <button onclick="App.User.filterTab('all', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold bg-indigo-100 text-indigo-700">Semua</button>
                 <button onclick="App.User.filterTab('siswa', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Siswa</button>
                 <button onclick="App.User.filterTab('guru', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Guru</button>
                 <button onclick="App.User.filterTab('pengawas', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Pengawas</button>
                 <button onclick="App.User.filterTab('admin', this)" class="tab-btn whitespace-nowrap px-4 py-2 rounded-md text-sm font-bold text-gray-500 hover:bg-gray-50">Admin</button>
               </div>
               <div class="flex gap-2 w-full md:w-auto">
                <button onclick="App.User.loadAll(true)" class="flex-1 md:flex-none px-4 py-2 bg-white border border-gray-300 text-gray-600 rounded-lg shadow-sm hover:text-indigo-600 transition" title="Refresh User">
                    <i id="btn-refresh-user" class="fas fa-sync-alt"></i>
                </button>
                <button onclick="App.User.modalOpen()" class="flex-1 md:flex-none px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> <span class="text-sm font-bold">User</span>
                </button>
               </div>
             </div>
             <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
               <div class="overflow-x-auto"><table class="w-full text-left border-collapse min-w-[600px]"><thead class="bg-gray-50 text-gray-600 uppercase text-xs"><tr><th class="p-4 border-b">Nama</th><th class="p-4 border-b">Role</th><th class="p-4 border-b">Kelas</th><th class="p-4 border-b">Status</th><th class="p-4 border-b text-right">Aksi</th></tr></thead><tbody id="tbody-users" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody></table></div>
             </div>
          </div>

          <div id="view-mapel" class="hidden animate__animated animate__fadeIn">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl md:text-2xl font-bold text-gray-800">Mapel</h2>
              
              <div class="flex gap-2">
                  <button onclick="App.Mapel.load(true)" class="px-3 py-2 bg-white border border-gray-300 text-gray-600 rounded-lg shadow-sm hover:text-indigo-600 transition" title="Refresh Mapel">
                      <i id="btn-refresh-mapel" class="fas fa-sync-alt"></i>
                  </button>

                  <button onclick="App.Mapel.modalOpen()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-lg flex items-center gap-2 font-semibold text-sm">
                      <i class="fas fa-plus-circle"></i> Tambah
                  </button>
              </div>
            </div>
            <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
              <div class="overflow-x-auto"><table class="w-full text-left border-collapse min-w-[500px]"><thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold"><tr><th class="p-4 border-b">Kode</th><th class="p-4 border-b">Nama Mapel</th><th class="p-4 border-b">Guru</th><th class="p-4 border-b text-right">Aksi</th></tr></thead><tbody id="tbody-mapel" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody></table></div>
            </div>
          </div>

          <div id="view-jadwal-siswa" class="hidden animate__animated animate__fadeIn">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Jadwal Ujian Aktif</h2>
            <div class="bg-white rounded-xl shadow p-4">
              <div id="list-ujian-siswa" class="space-y-4">
                  <p class="text-gray-400 text-center">Memuat jadwal...</p>
              </div>
            </div>
          </div>

          <div id="view-hasil-siswa" class="hidden animate__animated animate__fadeIn">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Riwayat Hasil Ujian</h2>
            <div class="bg-white rounded-xl shadow overflow-hidden border border-gray-200">
              <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse min-w-[800px]"> <thead class="bg-slate-50 text-slate-600 uppercase text-xs font-bold">
                      <tr>
                          <th class="p-4 border-b w-32">Tanggal</th>
                          <th class="p-4 border-b w-24">Pukul</th> 
                          <th class="p-4 border-b w-24">Sisa Waktu</th> 
                          <th class="p-4 border-b">Mata Pelajaran</th>
                          
                          <th class="p-4 border-b text-center w-32">Nilai Sementara<br><span class="text-[10px] text-gray-400 normal-case">(PG/BS/COCOK)</span></th>
                          <th class="p-4 border-b text-center w-32">Nilai Akhir<br><span class="text-[10px] text-gray-400 normal-case">(Rapor)</span></th>
                          
                          <th class="p-4 border-b text-center w-24">Detail</th>
                      </tr>
                    </thead>
                    <tbody id="tbody-hasil-siswa" class="text-sm divide-y divide-gray-100"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-hasil-ujian" class="hidden animate__animated animate__fadeIn">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
              <div>
                <h2 class="text-xl md:text-2xl font-bold text-gray-800">Hasil & Koreksi Ujian</h2>
                <p class="text-sm text-gray-500">Pantau nilai siswa dan lakukan koreksi manual (Essay).</p>
              </div>
              <div class="flex gap-2">
                <button onclick="App.GuruHasil.load(true)" class="px-4 py-2 bg-white border rounded-lg shadow-sm hover:text-indigo-600 transition">
                  <i class="fas fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
              <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse min-w-[900px]">
                  <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold">
                    <tr>
                      <th class="p-4 border-b">Nama Siswa</th>
                      <th class="p-4 border-b">Waktu Submit</th>
                      <th class="p-4 border-b">Mapel</th>
                      <th class="p-4 border-b text-center">Sisa Waktu</th>
                      <th class="p-4 border-b text-center">Nilai Sementara<br><span class="text-[9px] text-gray-400 normal-case">(Otomatis)</span></th>
                      <th class="p-4 border-b text-center">Nilai Akhir<br><span class="text-[9px] text-gray-400 normal-case">(Rapor)</span></th>
                      <th class="p-4 border-b text-center">Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="tbody-hasil-guru" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="view-remedial-guru" class="hidden animate__animated animate__fadeIn">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
              <div>
                <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-recycle text-indigo-600"></i> Remedial</h2>
                <p class="text-sm text-gray-500">Kelola jadwal & peserta remedial.</p>
              </div>
              <div class="flex gap-2">
                <button onclick="App.Remedial.loadList()" class="px-4 py-2 bg-white border rounded shadow hover:text-indigo-600"><i class="fas fa-sync-alt"></i></button>
                <button onclick="App.Remedial.openForm()" class="px-4 py-2 bg-indigo-600 text-white rounded font-bold shadow hover:bg-indigo-700"><i class="fas fa-plus"></i> Buat Remedial</button>
              </div>
            </div>

            <div class="flex gap-2 border-b mb-6 overflow-x-auto">
              <button onclick="App.Remedial.switchTab('jadwal')" id="tab-rem-jadwal" class="px-4 py-2 border-b-2 border-indigo-600 text-indigo-600 font-bold text-sm">Jadwal & Setting</button>
              <button onclick="App.Remedial.switchTab('monitoring')" id="tab-rem-monitoring" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-bold text-sm">Monitoring & Token</button>
            </div>

            <div id="rem-panel-jadwal" class="bg-white rounded-xl shadow border overflow-hidden">
              <div class="overflow-x-auto">
                  <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold">
                        <tr>
                          <th class="p-4 border-b">Nama Remedial</th>
                          <th class="p-4 border-b">Mapel Sumber</th>
                          <th class="p-4 border-b">Waktu</th>
                          <th class="p-4 border-b text-center">Peserta</th>
                          <th class="p-4 border-b text-center">Status</th>
                          <th class="p-4 border-b text-right">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-remedial" class="divide-y divide-gray-100"></tbody>
                  </table>
              </div>
            </div>

            <div id="rem-panel-monitoring" class="hidden">
              <div class="flex gap-4 mb-4">
                  <select id="sel-mon-remedial" onchange="App.Remedial.refreshMonitor()" class="input-std w-64 bg-white"><option value="">- Pilih Jadwal -</option></select>
                  <button onclick="App.Remedial.refreshMonitor()" class="px-4 py-2 bg-white border rounded shadow font-bold text-gray-600"><i class="fas fa-sync-alt"></i></button>
              </div>
              
              <div id="rem-token-box" class="hidden mb-4 bg-indigo-600 text-white p-4 rounded-xl shadow flex justify-between items-center">
                  <div>
                    <p class="text-xs font-bold uppercase text-indigo-200">Token Remedial</p>
                    <h2 class="text-3xl font-mono font-black tracking-widest" id="rem-token-text">---</h2>
                  </div>
                  <i class="fas fa-key text-4xl text-indigo-400 opacity-50"></i>
              </div>

              <div class="bg-white rounded-xl shadow border overflow-hidden">
                  <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold">
                        <tr>
                          <th class="p-4 border-b">Siswa</th>
                          <th class="p-4 border-b text-center">Status</th>
                          <th class="p-4 border-b text-center">Nilai</th>
                          <th class="p-4 border-b">Keterangan / Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-mon-remedial" class="divide-y divide-gray-100">
                        <tr><td colspan="4" class="p-8 text-center text-gray-400">Pilih jadwal remedial di atas.</td></tr>
                    </tbody>
                  </table>
              </div>
            </div>
          </div>

          <div id="modal-remedial" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
            <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto animate__animated animate__zoomIn">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                  <h3 class="font-bold text-lg">Setting Remedial</h3>
                  <button onclick="App.UI.closeModal('modal-remedial')"><i class="fas fa-times"></i></button>
                </div>
                <form onsubmit="App.Remedial.save(event)" class="space-y-4">
                  <input type="hidden" id="rem-id">
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="text-xs font-bold text-gray-500">Nama Kegiatan</label>
                        <input type="text" id="rem-nama" class="input-std" placeholder="Cth: Remedial PH 1 Matematika" required>
                      </div>
                      <div>
                        <label class="text-xs font-bold text-gray-500">Ambil Soal Dari Mapel</label>
                        <select id="rem-mapel" class="input-std bg-gray-50" required><option value="">Loading...</option></select>
                        <p class="text-[10px] text-gray-400 mt-1">*Pilih kode mapel/bank soal yang ingin diujikan.</p>
                      </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div><label class="text-xs font-bold text-gray-500">Mulai</label><input type="datetime-local" id="rem-mulai" class="input-std" required></div>
                      <div><label class="text-xs font-bold text-gray-500">Selesai</label><input type="datetime-local" id="rem-selesai" class="input-std" required></div>
                      <div><label class="text-xs font-bold text-gray-500">Durasi (Menit)</label><input type="number" id="rem-durasi" class="input-std" value="60"></div>
                  </div>

                  <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                      <label class="text-xs font-bold text-indigo-800 mb-2 block">Pilih Peserta Remedial</label>
                      <div class="flex gap-2 mb-2">
                        <select id="rem-filter-kelas" onchange="App.Remedial.loadSiswa(this.value)" class="input-std text-xs w-1/2">
                            <option value="">- Pilih Kelas -</option>
                        </select>
                        <span class="text-xs text-gray-500 flex items-center">Pilih kelas lalu centang siswa.</span>
                      </div>
                      <div id="rem-list-siswa" class="h-40 overflow-y-auto bg-white border rounded p-2 grid grid-cols-2 md:grid-cols-3 gap-2">
                        <p class="col-span-full text-center text-xs text-gray-400 py-4">Pilih kelas dulu.</p>
                      </div>
                      <div class="mt-2 text-xs text-gray-600">
                        Terpilih: <span id="rem-count-siswa" class="font-bold">0</span> Siswa
                      </div>
                  </div>
                  
                  <div class="flex gap-4">
                      <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="rem-acak-soal" checked> Acak Soal</label>
                      <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="rem-acak-opsi" checked> Acak Opsi</label>
                      <div class="ml-auto">
                        <label class="text-xs font-bold text-gray-500 mr-2">Status</label>
                        <select id="rem-status" class="border rounded px-2 py-1 text-sm"><option value="Aktif">Aktif</option><option value="Nonaktif">Nonaktif</option></select>
                      </div>
                  </div>

                  <div class="pt-4 text-right border-t">
                      <button type="submit" id="btn-rem-save" class="px-6 py-2 bg-indigo-600 text-white font-bold rounded shadow hover:bg-indigo-700">Simpan Remedial</button>
                  </div>
                </form>
            </div>
          </div>

          <div id="view-pengawas-token" class="hidden animate__animated animate__fadeIn">
             <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded-r shadow-sm">
                <div class="flex">
                   <div class="flex-shrink-0"><i class="fas fa-info-circle text-blue-500"></i></div>
                   <div class="ml-3">
                      <p class="text-sm text-blue-700">
                         Halaman ini menampilkan daftar ujian yang ditugaskan kepada Anda.
                         Tombol <b>Lihat Token</b> hanya akan aktif sesuai jadwal ujian.
                      </p>
                   </div>
                </div>
             </div>
             
             <div id="list-token-pengawas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
          </div>

          <div id="view-pengawas-kehadiran" class="hidden animate__animated animate__fadeIn">
             <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden flex flex-col min-h-[500px]">
                
                <div class="p-5 bg-emerald-50 border-b border-emerald-100 flex flex-col md:flex-row justify-between items-center gap-4">
                   <div class="flex items-center gap-4 w-full md:w-auto">
                      <div class="w-12 h-12 rounded-full bg-emerald-100 border border-emerald-200 flex items-center justify-center text-emerald-600 text-xl shadow-sm">
                          <i class="fas fa-user-check"></i>
                      </div>
                      <div>
                         <h3 class="font-bold text-gray-800 text-lg">Kehadiran Siswa</h3>
                         <p class="text-xs text-emerald-600 font-semibold">Cek Tanda Tangan & Waktu Masuk</p>
                      </div>
                   </div>
                   <div class="flex gap-2 w-full md:w-auto">
                      <select id="hadir-list-ujian" onchange="App.Pengawas.refreshKehadiran()" class="input-std bg-white shadow-sm border-gray-300 w-full md:w-64">
                         <option value="">- Pilih Ujian -</option>
                      </select>
                      <button onclick="App.Pengawas.refreshKehadiran()" class="px-4 py-2 bg-white border border-emerald-200 text-emerald-600 rounded shadow hover:bg-emerald-600 hover:text-white transition" title="Refresh Data">
                          <i class="fas fa-sync-alt"></i>
                      </button>
                   </div>
                </div>

                <div class="flex-1 overflow-auto bg-white">
                   <table class="w-full text-left text-sm border-collapse">
                      <thead class="bg-gray-100 text-gray-600 sticky top-0 z-10 shadow-sm uppercase text-xs">
                         <tr>
                            <th class="p-4 border-b">Nama Siswa</th>
                            <th class="p-4 border-b">Waktu Submit</th>
                            <th class="p-4 border-b text-center">Tanda Tangan</th>
                         </tr>
                      </thead>
                      <tbody id="tbody-hadir-pgw" class="divide-y divide-gray-100">
                         <tr><td colspan="3" class="p-10 text-center text-gray-400">Pilih ujian untuk melihat data kehadiran.</td></tr>
                      </tbody>
                   </table>
                </div>
             </div>
          </div>

          <div id="view-pengawas-monitor" class="hidden animate__animated animate__fadeIn">
             <div class="bg-white rounded-xl shadow border border-gray-200 overflow-hidden flex flex-col min-h-[500px]">
                
                <div class="p-4 bg-slate-50 border-b flex flex-col md:flex-row justify-between items-center gap-4">
                   <div class="flex items-center gap-3 w-full md:w-auto">
                      <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"><i class="fas fa-desktop"></i></div>
                      <div>
                         <h3 class="font-bold text-gray-700">Monitoring Siswa</h3>
                         <p class="text-xs text-gray-400">Pilih ujian untuk melihat status realtime</p>
                      </div>
                   </div>
                   <div class="flex gap-2 w-full md:w-auto">
                      <select id="mon-list-ujian" onchange="App.Pengawas.refreshMonitoring()" class="input-std bg-white shadow-sm border-gray-300 w-full md:w-64">
                         <option value="">- Pilih Ujian -</option>
                      </select>
                      <button onclick="App.Pengawas.refreshMonitoring()" class="px-3 py-2 bg-white border rounded shadow hover:text-indigo-600" title="Refresh Data"><i class="fas fa-sync-alt"></i></button>
                   </div>
                </div>

                <div id="mon-info-panel" class="hidden bg-indigo-600 text-white p-3 flex justify-between items-center px-6 shadow-inner">
                    <span class="text-xs font-bold uppercase tracking-wider text-indigo-200">Token Ujian Ini:</span>
                    <span id="mon-token-small" class="font-mono font-bold text-xl text-yellow-300 tracking-widest">---</span>
                </div>

                <div class="flex-1 overflow-auto bg-white relative">
                   <table class="w-full text-left text-sm border-collapse">
                      <thead class="bg-gray-100 text-gray-600 sticky top-0 z-10 shadow-sm uppercase text-xs">
                         <tr>
                            <th class="p-3 border-b">Siswa</th>
                            <th class="p-3 border-b text-center">Kelas</th>
                            <th class="p-3 border-b text-center">Status</th>
                         </tr>
                      </thead>
                      <tbody id="tbody-mon-pgw" class="divide-y divide-gray-100">
                         <tr><td colspan="4" class="p-10 text-center text-gray-400">Silakan pilih ujian di atas.</td></tr>
                      </tbody>
                   </table>
                </div>
             </div>
          </div>

          <div id="view-pengawas-pelanggaran" class="hidden animate__animated animate__fadeIn">
             <div class="bg-white rounded-xl shadow-lg border border-red-100 overflow-hidden flex flex-col min-h-[500px]">
                
                <div class="p-5 bg-red-50 border-b border-red-100 flex flex-col md:flex-row justify-between items-center gap-4">
                   <div class="flex items-center gap-4 w-full md:w-auto">
                      <div class="w-12 h-12 rounded-full bg-red-100 border border-red-200 flex items-center justify-center text-red-600 text-xl shadow-sm">
                          <i class="fas fa-exclamation-triangle"></i>
                      </div>
                      <div>
                         <h3 class="font-bold text-gray-800 text-lg">Pelanggaran Siswa</h3>
                         <p class="text-xs text-red-500 font-semibold">Daftar siswa yang terkunci sistem</p>
                      </div>
                   </div>
                   <div class="flex gap-2 w-full md:w-auto">
                      <select id="pel-list-ujian" onchange="App.Pengawas.refreshPelanggaran()" class="input-std bg-white shadow-sm border-gray-300 w-full md:w-64">
                         <option value="">- Pilih Ujian -</option>
                      </select>
                      <button onclick="App.Pengawas.refreshPelanggaran()" class="px-4 py-2 bg-white border border-red-200 text-red-500 rounded shadow hover:bg-red-500 hover:text-white transition" title="Refresh Data">
                          <i class="fas fa-sync-alt"></i>
                      </button>
                   </div>
                </div>

                <div class="flex-1 overflow-auto bg-white">
                   <table class="w-full text-left text-sm border-collapse">
                      <thead class="bg-gray-100 text-gray-600 sticky top-0 z-10 shadow-sm uppercase text-xs">
                         <tr>
                            <th class="p-4 border-b">Nama Siswa</th>
                            <th class="p-4 border-b text-center">Kelas</th>
                            <th class="p-4 border-b text-center">Status</th>
                            <th class="p-4 border-b">Keterangan Pelanggaran</th>
                            <th class="p-4 border-b text-center">Aksi</th>
                         </tr>
                      </thead>
                      <tbody id="tbody-pel-pgw" class="divide-y divide-gray-100">
                         <tr><td colspan="5" class="p-10 text-center text-gray-400">Pilih ujian untuk memindai pelanggaran.</td></tr>
                      </tbody>
                   </table>
                </div>
             </div>
          </div>

          <div id="view-admin-monitoring" class="hidden animate__animated animate__fadeIn">
             <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                
                <div class="lg:col-span-4 bg-white rounded-xl shadow border border-gray-200 flex flex-col h-[600px] overflow-hidden sticky top-6">
                   <div class="p-4 border-b bg-gray-50 flex justify-between items-center shrink-0">
                      <div>
                        <h3 class="font-bold text-gray-700"><i class="fas fa-list"></i> Ujian Aktif</h3>
                        <p class="text-[10px] text-gray-400">Pilih ujian untuk melihat detail</p>
                      </div>
                      <button onclick="App.AdminMonitor.loadSummary()" class="text-gray-500 hover:text-indigo-600 p-2"><i class="fas fa-sync-alt"></i></button>
                   </div>
                   <div id="adm-list-exams" class="overflow-y-auto flex-1 p-3 space-y-3 bg-gray-50 scroll-smooth"></div>
                </div>

                <div class="lg:col-span-8 flex flex-col gap-6">
                   
                   <div class="bg-white rounded-xl shadow border border-gray-200 flex flex-col min-h-[500px] relative">
                       <div class="p-4 border-b bg-indigo-600 text-white flex justify-between items-center z-10 shrink-0">
                          <div>
                             <h3 class="font-bold text-lg" id="adm-mon-title">Pilih Ujian</h3>
                             <p class="text-xs text-indigo-200" id="adm-mon-subtitle">Klik list di samping kiri</p>
                          </div>
                          <div class="text-right hidden" id="adm-header-stats">
                              <span class="block text-2xl font-mono font-black tracking-widest text-yellow-300" id="adm-mon-token">---</span>
                              <span class="text-[10px] uppercase font-bold text-indigo-200">Token Ujian Ini</span>
                          </div>
                       </div>
                       <div class="flex-1 overflow-auto bg-white">
                          <table class="w-full text-left text-sm border-collapse">
                             <thead class="bg-slate-100 text-slate-600 sticky top-0 z-10 shadow-sm">
                                <tr>
                                   <th class="p-3 border-b">Nama Siswa</th>
                                   <th class="p-3 border-b text-center">Kelas</th>
                                   <th class="p-3 border-b text-center">Status</th>
                                   <th class="p-3 border-b text-center">Aksi</th>
                                </tr>
                             </thead>
                             <tbody id="tbody-adm-monitoring" class="divide-y divide-gray-100">
                                <tr><td colspan="4" class="p-10 text-center text-gray-400">Belum ada data.</td></tr>
                             </tbody>
                          </table>
                       </div>
                   </div>

                   <div class="bg-red-50 rounded-xl shadow border border-red-200 h-48 flex flex-col shrink-0 overflow-hidden">
                      <div class="px-4 py-2 border-b border-red-200 bg-red-100 flex justify-between items-center shrink-0">
                         <h4 class="text-sm font-bold text-red-800 uppercase flex items-center gap-2">
                            <i class="fas fa-exclamation-circle text-red-600"></i> Menu Pelanggaran / Buka Kunci
                         </h4>
                         <span id="badge-locked-count" class="bg-red-600 text-white text-[10px] px-2 py-0.5 rounded-full font-bold hidden">0</span>
                      </div>
                      <div id="list-adm-locked" class="p-3 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-3 content-start">
                         <p class="text-xs text-gray-400 italic w-full text-center col-span-full mt-4">Tidak ada siswa yang terkunci saat ini.</p>
                      </div>
                   </div>

                </div>
             </div>
          </div>

          <div id="view-admin-hasil" class="hidden animate__animated animate__fadeIn">
             <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">Hasil Ujian</h2>
                <div class="flex gap-2 w-full md:w-auto">
                   <select id="filter-hasil-admin" onchange="App.AdminHasil.load()" class="input-std w-full md:w-64">
                      <option value="">- Semua Mapel -</option>
                   </select>
                   <button onclick="App.AdminHasil.load(true)" class="px-4 py-2 bg-white border rounded shadow hover:text-indigo-600">
                      <i class="fas fa-sync-alt"></i>
                   </button>
                </div>
             </div>
             <div class="bg-white rounded-xl shadow overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                   <table class="w-full text-left border-collapse min-w-[600px]">
                      <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-bold">
                         <tr>
                            <th class="p-4 border-b">Waktu Submit</th>
                            <th class="p-4 border-b">Nama Siswa</th>
                            <th class="p-4 border-b">Mapel</th>
                            <th class="p-4 border-b text-center">Benar / Total</th>
                            <th class="p-4 border-b text-center">Nilai Akhir</th>
                         </tr>
                      </thead>
                      <tbody id="tbody-hasil-admin" class="text-sm text-gray-700 divide-y divide-gray-100"></tbody>
                   </table>
                </div>
             </div>
          </div>

        </div>
      </main>
    </div>

    <div id="page-siswa" class="hidden fixed inset-0 z-50 bg-gray-100 flex flex-col font-sans h-[100dvh] overflow-hidden supports-[height:100dvh]:h-[100dvh]">
        <header class="bg-slate-900 text-white px-4 py-3 flex justify-between items-center z-40 shrink-0 shadow-md">
             <div class="flex items-center gap-3 overflow-hidden">
               <button onclick="App.Exam.toggleNavMobile()" class="md:hidden text-gray-300 hover:text-white transition">
                  <i class="fas fa-th-large text-xl"></i>
               </button>
               
               <div class="w-8 h-8 md:w-10 md:h-10 bg-indigo-600 rounded-full flex items-center justify-center font-bold text-sm md:text-base shrink-0">S</div>
               <div class="min-w-0">
                  <h1 class="font-bold text-sm truncate" id="header-nama">Siswa</h1>
                  <p class="text-[10px] md:text-xs text-gray-400 truncate" id="header-mapel">-</p>
               </div>
             </div>
             <div class="bg-slate-800 px-3 py-1 rounded text-base md:text-lg font-mono font-bold text-yellow-400 shrink-0 shadow-inner border border-slate-700" id="timer-display">--:--</div>
        </header>

        <main class="flex-1 flex flex-col md:flex-row overflow-hidden relative" id="main-exam-area">
             
             <aside id="exam-sidebar" class="hidden md:flex flex-col w-full md:w-64 bg-white border-r z-50 md:z-30 absolute md:static inset-0 md:h-full shadow-2xl md:shadow-lg transform transition-transform duration-300">
                <div class="p-3 border-b font-bold text-center bg-gray-50 flex justify-between items-center md:justify-center">
                    <span>Navigasi Soal</span>
                    <button onclick="App.Exam.toggleNavMobile()" class="md:hidden text-red-500 px-2"><i class="fas fa-times text-xl"></i></button>
                </div>
                
                <div class="flex-1 p-3 overflow-y-auto">
                    <div id="grid-nomor" class="grid grid-cols-5 gap-2 content-start"></div>
                </div>
                
                <div class="p-3 border-t bg-gray-50">
                    <div class="grid grid-cols-2 gap-2 text-[10px] mb-2 text-gray-500">
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-indigo-600 rounded"></div> Isi</div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-yellow-400 rounded"></div> Ragu</div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 bg-white border rounded"></div> Kosong</div>
                        <div class="flex items-center gap-1"><div class="w-3 h-3 border-4 border-indigo-200 rounded"></div> Aktif</div>
                    </div>
                    <button onclick="App.Exam.finish()" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded font-bold transition shadow">SELESAI</button>
                </div>
             </aside>
             
             <div class="flex-1 flex flex-col relative w-full h-full order-1 md:order-2 bg-gray-100">
                 <div id="exam-loading" class="flex flex-col items-center justify-center h-full text-gray-500 absolute inset-0 bg-gray-100 z-10">
                    <i class="fas fa-spinner fa-spin text-3xl mb-2"></i> <p>Memuat Soal...</p>
                 </div>
                 
                 <div id="soal-container" class="hidden flex-1 overflow-auto p-4 md:p-8 pb-32 md:pb-20 scroll-smooth w-full" style="-webkit-overflow-scrolling: touch;">
                    <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-sm border border-gray-200 p-4 md:p-6 min-h-[50vh]">
                        
                        <div class="flex justify-between items-start mb-4 border-b pb-3">
                            <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-bold shadow-sm">
                                No. <span id="disp-no">1</span>
                            </span>
                            
                            <div id="soal-status-icon" class="flex gap-2">
                                </div>
                        </div>

                        <div id="disp-pertanyaan" class="text-base md:text-lg mb-6 text-gray-800 leading-loose font-medium"></div>
                        
                        <div id="disp-gambar-container" class="hidden mb-6 flex justify-center bg-gray-50 rounded-lg border border-dashed border-gray-300 p-2">
                            <img id="disp-gambar" class="rounded max-h-[40vh] md:max-h-96 shadow-sm cursor-zoom-in" onclick="App.UI.zoomImg(this)">
                        </div>
                        
                        <div id="disp-opsi" class="space-y-3"></div>
                    </div>
                 </div>

                 <div id="nav-buttons" class="hidden shrink-0 bg-white border-t p-3 flex justify-between items-center shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-20">
                    <button onclick="App.Exam.prev()" class="px-4 py-2.5 bg-gray-100 hover:bg-gray-200 border rounded-lg text-sm font-bold text-gray-700 w-28 flex items-center justify-center gap-2 transition active:scale-95">
                        <i class="fas fa-arrow-left"></i> Prev
                    </button>
                    
                    <button onclick="App.Exam.toggleRagu()" class="px-2 py-1 md:px-4 md:py-2 bg-yellow-50 text-yellow-600 border border-yellow-200 rounded-lg text-xs md:text-sm font-bold flex flex-col items-center leading-none gap-1 hover:bg-yellow-100 transition active:scale-95">
                        <i class="fas fa-bookmark text-base md:text-lg"></i> 
                        <span>Ragu</span>
                    </button>
                    
                    <button onclick="App.Exam.next()" id="btn-next-soal" class="px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-bold w-28 flex items-center justify-center gap-2 shadow-md transition active:scale-95">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                 </div>
             </div>
        </main>
    </div>

    <div id="page-attendance" class="hidden fixed inset-0 z-[60] bg-gray-100 flex flex-col font-sans h-[100dvh] overflow-hidden">
       
       <header class="bg-white shadow-sm px-6 py-4 flex justify-between items-center shrink-0 relative z-10">
          <div class="flex items-center gap-3">
             <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white">
                <i class="fas fa-fingerprint text-xl"></i>
             </div>
             <div>
                <h1 class="font-bold text-gray-800 text-lg leading-tight">Konfirmasi Kehadiran</h1>
                <p class="text-xs text-gray-500" id="att-subtitle">Mapel: -</p>
             </div>
          </div>
          <div class="text-right">
             <div id="att-clock" class="text-xl font-mono font-bold text-indigo-600">--:--:--</div>
             <div id="att-date" class="text-xs text-gray-500 font-semibold">...</div>
          </div>
       </header>

       <main class="flex-1 overflow-y-auto w-full bg-gray-100 relative scroll-smooth">
          
          <div class="min-h-full flex flex-col items-center justify-center p-4 py-10">
             
             <div class="w-full max-w-md bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden relative">
                
                <div class="p-6 bg-slate-50 border-b">
                   <div class="flex justify-between items-center mb-4">
                      <h3 class="font-bold text-gray-700">Tanda Tangan Digital</h3>
                      <button onclick="App.Attendance.clearCanvas()" class="text-xs text-red-500 hover:text-red-700 font-bold border border-red-200 bg-white px-2 py-1 rounded shadow-sm">
                         <i class="fas fa-undo"></i> Ulangi
                      </button>
                   </div>
                   
                   <div class="relative w-full h-64 bg-white border-2 border-dashed border-gray-300 rounded-lg cursor-crosshair touch-none" id="canvas-container">
                      <canvas id="signature-pad" class="w-full h-full block"></canvas>
                      <div id="sign-placeholder" class="absolute inset-0 flex items-center justify-center pointer-events-none text-gray-300">
                         <span class="text-sm">Tanda tangan di sini</span>
                      </div>
                   </div>
                   <p class="text-[10px] text-gray-400 mt-2 text-center">*Gunakan jari atau mouse untuk tanda tangan.</p>
                </div>

                <div class="p-6">
                   <div class="flex items-start gap-3 mb-6 bg-blue-50 p-3 rounded-lg border border-blue-100">
                      <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
                      <p class="text-xs text-blue-700 leading-relaxed">
                         Dengan menekan tombol di bawah, saya menyatakan hadir dan siap mengerjakan ujian secara jujur sesuai waktu yang tercatat server.
                      </p>
                   </div>

                   <button id="btn-submit-att" onclick="App.Attendance.submit()" class="w-full py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                      <span>SUBMIT & MULAI</span> <i class="fas fa-arrow-right"></i>
                   </button>
                   
                   <button onclick="App.Attendance.close()" class="w-full mt-3 py-3 text-gray-500 hover:text-gray-700 font-bold text-sm">
                      Batal
                   </button>
                </div>
             </div>
             </div>
       </main>
    </div>

    <div id="modal-mapel" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6 animate__animated animate__zoomIn max-h-[90vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-5 border-b pb-3"><h3 class="text-xl font-bold text-gray-800" id="modal-mapel-title">Tambah Mapel</h3><button onclick="App.UI.closeModal('modal-mapel')" class="text-gray-400"><i class="fas fa-times"></i></button></div>
          <form onsubmit="App.Mapel.save(event)" class="space-y-4">
             <input type="hidden" id="m-id">
             <div><label class="text-xs font-bold text-gray-500">Kode</label><input type="text" id="m-kode" class="input-std uppercase" required></div>
             <div><label class="text-xs font-bold text-gray-500">Nama</label><input type="text" id="m-nama" class="input-std" required></div>
             <div><label class="text-xs font-bold text-gray-500">Guru</label><select id="m-guru" class="input-std bg-gray-50"><option value="-">- Pilih -</option></select></div>
             <div class="pt-4 flex justify-end gap-3"><button type="button" onclick="App.UI.closeModal('modal-mapel')" class="px-4 py-2 bg-gray-100 rounded-lg">Batal</button><button type="submit" id="btnSimpanMapel" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">Simpan</button></div>
          </form>
       </div>
    </div>

    <div id="modal-user" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
      <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 animate__animated animate__zoomIn max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-5 border-b pb-3"><h3 class="text-xl font-bold text-gray-800" id="modal-title">User</h3><button onclick="App.UI.closeModal('modal-user')" class="text-gray-400"><i class="fas fa-times"></i></button></div>
        <form onsubmit="App.User.save(event)" class="space-y-4">
           <input type="hidden" id="u-id">
           <div class="grid grid-cols-2 gap-4"><div><label class="text-xs font-bold text-gray-500">Role</label><select id="u-role" class="input-std" onchange="App.User.toggleKelasInput()" required><option value="siswa">Siswa</option><option value="guru">Guru</option><option value="pengawas">Pengawas</option><option value="admin">Admin</option></select></div><div><label class="text-xs font-bold text-gray-500">Status</label><select id="u-status" class="input-std"><option value="Aktif">Aktif</option><option value="Nonaktif">Banned</option></select></div></div>
           <div><label class="text-xs font-bold text-gray-500">Nama Lengkap</label><input type="text" id="u-nama" class="input-std" required></div>
           <div class="grid grid-cols-2 gap-4"><div><label class="text-xs font-bold text-gray-500">Username</label><input type="text" id="u-username" class="input-std" required></div><div><label class="text-xs font-bold text-gray-500">Password</label><input type="text" id="u-password" class="input-std" required></div></div>
           <div id="div-kelas"><label class="text-xs font-bold text-gray-500">Kelas</label><input type="text" id="u-kelas" class="input-std"></div>
           <div class="pt-4 flex justify-end gap-3"><button type="button" onclick="App.UI.closeModal('modal-user')" class="px-4 py-2 bg-gray-100 rounded-lg">Batal</button><button type="submit" id="btnSimpanUser" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">Simpan</button></div>
        </form>
      </div>
    </div>

    <div id="modal-jenis" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-sm rounded-xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
          <div class="flex justify-between mb-4 border-b pb-2"><h3 class="font-bold text-lg" id="modal-jenis-title">Nama Ujian</h3><button onclick="App.UI.closeModal('modal-jenis')"><i class="fas fa-times"></i></button></div>
          <form id="formJenis" onsubmit="App.Ujian.saveJenis(event)" class="space-y-3">
             <input type="hidden" id="j-id">
             <div><label class="text-xs font-bold text-gray-500">Nama Event</label><input type="text" id="j-nama" class="input-std" placeholder="Contoh: PAS Ganjil 2024" required></div>
             <div><label class="text-xs font-bold text-gray-500">Keterangan</label><input type="text" id="j-ket" class="input-std" placeholder="Opsional"></div>
             <div><label class="text-xs font-bold text-gray-500">Status</label><select id="j-status" class="input-std"><option value="Aktif">Aktif</option><option value="Nonaktif">Nonaktif</option></select></div>
             
             <div class="pt-4 flex justify-end gap-2">
                <button type="button" onclick="App.UI.closeModal('modal-jenis')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded font-bold transition">Batal</button>
                <button type="submit" id="btnSimpanJenis" class="px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white rounded font-bold shadow transition">Simpan</button>
             </div>
          </form>
       </div>
    </div>

    <div id="modal-jadwal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6 max-h-[90vh] overflow-y-auto">
          <div class="flex justify-between mb-4 border-b pb-2"><h3 class="font-bold text-lg" id="modal-jadwal-title">Set Ujian</h3><button onclick="App.UI.closeModal('modal-jadwal')"><i class="fas fa-times"></i></button></div>
          <form id="formJadwal" onsubmit="App.Ujian.saveJadwal(event)" class="space-y-3">
             <input type="hidden" id="sch-id">
             
             <div><label class="text-xs font-bold text-gray-500">Pilih Nama Ujian</label><select id="sch-jenis" class="input-std bg-gray-50" required><option value="">Loading...</option></select></div>
             
             <div><label class="text-xs font-bold text-gray-500">Pilih Mapel / Bank Soal</label><select id="sch-mapel" class="input-std bg-gray-50" required><option value="">Loading...</option></select></div>
             
             <div class="grid grid-cols-2 gap-3">
               <div><label class="text-xs font-bold text-gray-500">Mulai</label><input type="datetime-local" id="sch-mulai" class="input-std" required></div>
               <div><label class="text-xs font-bold text-gray-500">Selesai</label><input type="datetime-local" id="sch-selesai" class="input-std" required></div>
             </div>

             <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                <div class="mb-2">
                   <label class="text-xs font-bold text-indigo-800">Durasi Pengerjaan (Menit)</label>
                   <input type="number" id="sch-durasi" class="input-std border-indigo-200" placeholder="Contoh: 90" required min="1">
                </div>
                <div class="flex gap-4 mt-2">
                   <label class="flex items-center gap-2 cursor-pointer">
                      <input type="checkbox" id="sch-acak-soal" class="accent-indigo-600 w-4 h-4">
                      <span class="text-xs font-bold text-gray-600">Acak Soal</span>
                   </label>
                   <label class="flex items-center gap-2 cursor-pointer">
                      <input type="checkbox" id="sch-acak-opsi" class="accent-indigo-600 w-4 h-4">
                      <span class="text-xs font-bold text-gray-600">Acak Jawaban</span>
                   </label>
                </div>
             </div>

             <div><label class="text-xs font-bold text-gray-500">Status Enrollment</label><select id="sch-status" class="input-std"><option value="Aktif">Aktif (Bisa dikerjakan)</option><option value="Nonaktif">Nonaktif / Tutup</option></select></div>

             <div>
               <label class="text-xs font-bold text-gray-500">Pilih Pengawas</label>
               <select id="sch-pengawas" class="input-std bg-gray-50">
                 <option value="">Loading...</option>
               </select>
             </div>

              <div class="mt-3">
                <label class="text-xs font-bold text-gray-500">Target Kelas</label>
                <select id="sch-kelas" class="input-std bg-yellow-50 font-semibold text-gray-700">
                  <option value="Semua">Loading...</option>
                </select>
              </div>

             <div class="pt-4 text-right"><button type="button" onclick="App.UI.closeModal('modal-jadwal')" class="px-5 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-bold transition">Batal</button><button type="submit" id="btnSimpanJadwal" class="px-6 py-2 bg-indigo-600 text-white rounded font-bold shadow">Simpan</button></div>
          </form>
       </div>
    </div>

    <div id="modal-import" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
       <div class="bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 animate__animated animate__zoomIn max-h-[90vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-5 border-b pb-3">
             <h3 class="text-xl font-bold text-gray-800"><i class="fas fa-file-excel text-green-600"></i> Import Bank Soal (Excel)</h3>
             <button onclick="App.UI.closeModal('modal-import')" class="text-gray-400"><i class="fas fa-times"></i></button>
          </div>
          
          <div class="space-y-4">
            <div class="bg-green-50 p-4 rounded-lg border border-green-200 flex justify-between items-center">
              <div>
                <h4 class="font-bold text-green-800 text-sm">Download Format</h4>
                <p class="text-xs text-green-600">Dapatkan template Excel & Petunjuk.</p>
              </div>
              <button onclick="App.BankSoal.downloadTemplate()" id="btn-dl-template" class="px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded hover:bg-green-700 shadow transition">
                <i class="fas fa-download"></i> Download .ZIP
              </button>
            </div>
      
            <form onsubmit="App.BankSoal.handleImport(event)" class="space-y-4">
              <div>
                 <label class="block font-semibold mb-1 text-sm text-gray-600">Mapel Tujuan</label>
                 <select id="import-mapel" class="input-std bg-gray-50" required>
                   <option value="">Loading...</option>
                 </select>
              </div>
              
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition relative">
                 <input type="file" id="import-file" accept=".zip" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="document.getElementById('file-label').innerText = this.files[0].name" required>
                 <div class="pointer-events-none">
                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                    <p class="text-sm font-bold text-gray-600" id="file-label">Klik untuk pilih file ZIP</p>
                    <p class="text-[10px] text-gray-400 mt-1">Wajib format .ZIP berisi file Excel (.xlsx) dan Media.</p>
                 </div>
              </div>
      
              <div class="pt-2 flex justify-end gap-3">
                 <button type="button" onclick="App.UI.closeModal('modal-import')" class="px-4 py-2 bg-gray-100 rounded-lg text-sm font-bold">Batal</button>
                 <button type="submit" id="btn-action-import" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold shadow hover:bg-indigo-700 text-sm">Mulai Import</button>
              </div>
            </form>
          </div>
       </div>
    </div>

    <div id="modal-detail-jawaban" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-4xl rounded-xl shadow-2xl flex flex-col max-h-[90vh] animate__animated animate__zoomIn">
            
            <div class="p-4 border-b flex justify-between items-center bg-white rounded-t-xl shrink-0 z-10 shadow-sm">
                <div>
                    <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
                        <i class="fas fa-file-signature text-indigo-600"></i> Detail Jawaban
                    </h3>
                    <p class="text-xs text-gray-500">Hasil koreksi sistem & kunci jawaban.</p>
                </div>
                <button onclick="App.UI.closeModal('modal-detail-jawaban')" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 flex items-center justify-center transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-4 md:p-6 bg-slate-100" id="container-detail-soal">
                </div>

            <div class="p-4 border-t bg-white rounded-b-xl shrink-0 text-right flex justify-end gap-2">
                <button onclick="App.UI.closeModal('modal-detail-jawaban')" class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow transition">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <div id="modal-preview-soal" class="hidden fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-3xl rounded-xl shadow-2xl flex flex-col max-h-[90vh] animate__animated animate__zoomIn">
            <div class="p-4 border-b flex justify-between items-center bg-white rounded-t-xl z-10 shrink-0">
                 <div class="flex items-center gap-2">
                     <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                         <i class="fas fa-eye"></i>
                     </div>
                     <div>
                         <h3 class="font-bold text-lg text-gray-800">Preview Soal</h3>
                         <p class="text-xs text-gray-500">Tampilan simulasi ujian siswa</p>
                     </div>
                 </div>
                 <button onclick="App.UI.closeModal('modal-preview-soal')" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-500 flex items-center justify-center transition">
                     <i class="fas fa-times"></i>
                 </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 md:p-8 bg-gray-100" id="container-preview-content">
                 </div>
            
            <div class="p-4 border-t bg-white rounded-b-xl text-right shrink-0">
                 <button onclick="App.UI.closeModal('modal-preview-soal')" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-bold shadow-sm transition">
                    Tutup Preview
                 </button>
            </div>
        </div>
    </div>

    <div id="modal-koreksi" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm p-2 md:p-4">
        <div class="bg-white w-full max-w-5xl rounded-xl shadow-2xl flex flex-col h-[90vh] md:h-[95vh] animate__animated animate__zoomIn">
            
            <div class="p-4 border-b flex justify-between items-center bg-indigo-600 text-white rounded-t-xl shrink-0 shadow-md">
                <div>
                    <h3 class="font-bold text-lg md:text-xl flex items-center gap-2">
                        <i class="fas fa-pen-nib"></i> Koreksi Jawaban
                    </h3>
                    <p class="text-xs text-indigo-100" id="kor-subtitle">Siswa: - | Mapel: -</p>
                </div>
                <button onclick="App.UI.closeModal('modal-koreksi')" class="text-white hover:text-red-200 text-xl"><i class="fas fa-times"></i></button>
            </div>

            <div class="flex-1 overflow-hidden flex flex-col md:flex-row bg-gray-100">
                <div class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6" id="container-koreksi-soal">
                    </div>

                <div class="w-full md:w-80 bg-white border-l shadow-lg shrink-0 flex flex-col z-10">
                    <div class="p-5 border-b bg-gray-50">
                        <h4 class="font-bold text-gray-700 text-sm uppercase mb-3">Rekapitulasi Nilai</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm mb-2">
                            <div class="text-gray-500">Total Bobot:</div>
                            <div class="text-right font-bold" id="kor-total-bobot">0</div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                            <div class="text-gray-500">Skor Perolehan:</div>
                            <div class="text-right font-bold text-indigo-600" id="kor-total-skor">0</div>
                        </div>
                        <div class="bg-indigo-600 text-white p-4 rounded-lg text-center shadow-inner">
                            <span class="block text-xs text-indigo-200 uppercase font-bold">Nilai Akhir</span>
                            <span class="block text-4xl font-black tracking-tighter" id="kor-nilai-akhir">0</span>
                        </div>
                    </div>
                    
                    <div class="p-5 space-y-3 bg-white flex-1 overflow-y-auto">
                        <button onclick="App.GuruKoreksi.simpan('draft')" class="w-full py-3 bg-gray-100 text-gray-700 font-bold rounded-lg border border-gray-300 hover:bg-gray-200 transition">
                            <i class="fas fa-save mr-2"></i> Simpan Sementara
                        </button>
                        <button onclick="App.GuruKoreksi.simpan('publish')" class="w-full py-3 bg-emerald-600 text-white font-bold rounded-lg shadow hover:bg-emerald-700 transition transform active:scale-95">
                            <i class="fas fa-paper-plane mr-2"></i> Kirim ke Nilai Akhir
                        </button>
                        
                        <div id="btn-batal-publish" class="hidden pt-4 border-t mt-2">
                            <button onclick="App.GuruKoreksi.batal()" class="w-full py-2 bg-red-50 text-red-600 font-bold rounded-lg border border-red-200 hover:bg-red-100 transition text-sm">
                                <i class="fas fa-undo mr-1"></i> Batalkan Kirim
                            </button>
                            <p class="text-[10px] text-center text-gray-400 mt-1">Nilai akan ditarik dari siswa.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-kalkulasi" class="hidden fixed inset-0 z-[80] flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl flex flex-col max-h-[90vh] animate__animated animate__zoomIn">
            <div class="p-4 border-b bg-slate-50 rounded-t-xl flex justify-between items-center">
                <div>
                   <h3 class="font-bold text-lg text-gray-800"><i class="fas fa-calculator text-indigo-600"></i> Transparansi Nilai</h3>
                   <p class="text-xs text-gray-500" id="calc-subtitle">Detail perhitungan skor per soal</p>
                </div>
                <button onclick="App.UI.closeModal('modal-kalkulasi')" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4 md:p-6 bg-white">
                <div class="overflow-hidden border rounded-lg mb-6">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-100 text-gray-600 font-bold uppercase text-xs">
                            <tr>
                                <th class="p-3 text-center w-12">No</th>
                                <th class="p-3">Tipe Soal</th>
                                <th class="p-3 text-right">Bobot Maks</th>
                                <th class="p-3 text-right">Skor Kamu</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-kalkulasi" class="divide-y divide-gray-100 text-gray-700">
                            </tbody>
                        <tfoot class="bg-indigo-50 font-bold text-indigo-900">
                            <tr>
                                <td colspan="2" class="p-3 text-right">TOTAL</td>
                                <td class="p-3 text-right" id="calc-tot-bobot">0</td>
                                <td class="p-3 text-right" id="calc-tot-skor">0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
                    <p class="text-xs font-bold text-gray-500 uppercase mb-2">Rumus Nilai Akhir:</p>
                    <div class="flex flex-col md:flex-row items-center justify-center gap-4 text-gray-800 font-mono text-lg md:text-xl font-bold bg-white p-4 rounded shadow-sm border">
                        <div class="flex flex-col items-center">
                            <span class="border-b-2 border-gray-400 w-full text-center px-2" id="rumus-skor">0</span>
                            <span id="rumus-bobot">0</span>
                        </div>
                        <span>&times; 100</span>
                        <span>=</span>
                        <span class="text-2xl text-indigo-600" id="rumus-hasil">0</span>
                    </div>
                    <p class="text-[10px] text-center text-gray-400 mt-2 italic">* Nilai Akhir dibulatkan 2 desimal jika perlu.</p>
                </div>
            </div>
            
            <div class="p-4 border-t bg-gray-50 rounded-b-xl text-right">
                <button onclick="App.UI.closeModal('modal-kalkulasi')" class="px-5 py-2 bg-indigo-600 text-white rounded-lg font-bold shadow hover:bg-indigo-700 transition">Tutup</button>
            </div>
        </div>
    </div>

    <div id="lock-screen" class="hidden fixed inset-0 z-[100] bg-red-900 flex items-center justify-center text-white text-center p-6">
       <div class="max-w-md w-full">
         <i class="fas fa-lock text-5xl mb-4 animate-bounce"></i>
         <h2 class="text-2xl font-bold mb-2">TERKUNCI!</h2>
         
         <div id="lock-timer" class="text-4xl font-mono font-bold text-yellow-300 my-4 tracking-widest border-2 border-red-700 bg-red-800 rounded-lg py-2 inline-block px-6 shadow-inner">
            --:--
         </div>
         <p id="lock-reason" class="mb-4 text-red-200">Keluar aplikasi.</p>
         <input type="password" id="token-unlock" class="w-full p-3 text-black text-center text-xl font-bold rounded-lg mb-4 outline-none focus:ring-4 ring-red-500" placeholder="TOKEN PENGAWAS">
         <button onclick="App.Security.unlock()" id="btnUnlock" class="w-full py-3 bg-white text-red-900 font-bold rounded-lg shadow-lg">BUKA KUNCI</button>
       </div>
    </div>

    <?!= include('JavaScript'); ?>
  </body>
</html>
